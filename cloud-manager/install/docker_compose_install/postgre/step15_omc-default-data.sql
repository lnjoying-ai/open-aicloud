INSERT INTO "public"."tbl_omc_alert_group" ("id", "name", "description", "status", "bp_id", "user_id", "create_time", "update_time") VALUES ('1', '轻量级节点-节点', '节点', 0, NULL, NULL, '2023-11-01 15:20:56.533049+08', '2023-11-01 15:20:56.533049+08');
INSERT INTO "public"."tbl_omc_alert_group" ("id", "name", "description", "status", "bp_id", "user_id", "create_time", "update_time") VALUES ('3', '轻量级节点-节点-固定阈值', '节点2', 0, NULL, NULL, '2023-11-20 11:35:19+08', '2023-11-20 11:35:22+08');
INSERT INTO "public"."tbl_omc_alert_group" ("id", "name", "description", "status", "bp_id", "user_id", "create_time", "update_time") VALUES ('4', '轻量级节点-容器', '容器', 0, NULL, NULL, '2023-11-23 16:03:24+08', '2023-11-23 16:03:26+08');

INSERT INTO "public"."tbl_omc_alert_metric" ("id", "group_id", "metric_name", "label", "duration_time", "level", "message", "metric_key", "alert_condition_display_statement", "alert_condition_param", "data_condition_label", "data_filters", "prom_content", "status", "bp_id", "user_id", "create_time", "update_time") VALUES ('3', '1', '节点状态异常', NULL, 10, 3, '节点{{$labels.node_id}}处于不可用状态超过10分钟', 'up', '当 ${metrics_name} 时，满足告警条件。', '[{"labelName":"metrics_name","showType":"text","detail":{"value":"节点状态异常"}}]', '[{"label":"node_id","labelName":"节点","minWidth":160,"maxWidth":200,"children":null}]', '[{"filterLabel":"node_id","filterDim":"node_id","filterDimName":"节点","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]}]', 'up{${node_id}} ==  0', 0, NULL, NULL, '2023-11-01 16:07:32.623255+08', '2023-11-01 16:07:32.623255+08');
INSERT INTO "public"."tbl_omc_alert_metric" ("id", "group_id", "metric_name", "label", "duration_time", "level", "message", "metric_key", "alert_condition_display_statement", "alert_condition_param", "data_condition_label", "data_filters", "prom_content", "status", "bp_id", "user_id", "create_time", "update_time") VALUES ('2', '1', '节点内存使用率', NULL, 10, 3, '节点 {{ $labels.node_id }} 内存使用率{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%，当前内存使用率 {{  printf "%.2f" $value }}%', 'node_memory_usage', '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', '[{"labelName":"metrics_name","showType":"text","detail":{"value":"节点内存使用率"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":90,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', '[{"label":"node_id","labelName":"节点","minWidth":160,"maxWidth":200,"children":null}]', '[{"filterLabel":"node_id","filterDim":"node_id","filterDimName":"节点","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]}]', '100 - node_memory_MemAvailable_bytes{${node_id}} / node_memory_MemTotal_bytes{${node_id}} * 100 ${opt} ${value}', 0, NULL, NULL, '2023-11-01 15:57:15.934687+08', '2023-11-01 15:57:15.934687+08');
INSERT INTO "public"."tbl_omc_alert_metric" ("id", "group_id", "metric_name", "label", "duration_time", "level", "message", "metric_key", "alert_condition_display_statement", "alert_condition_param", "data_condition_label", "data_filters", "prom_content", "status", "bp_id", "user_id", "create_time", "update_time") VALUES ('1', '1', '节点cpu使用率', NULL, 10, 2, '节点 {{$labels.node_id }} CPU使用率{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%，当前CPU使用率 {{ printf "%.2f" $value }}%', 'node_cpu_usage', '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', '[{"labelName":"metrics_name","showType":"text","detail":{"value":"节点CPU使用率"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":90,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', '[{"label":"node_id","labelName":"节点","minWidth":160,"maxWidth":200,"children":null}]', '[{"filterLabel":"node_id","filterDim":"node_id","filterDimName":"节点","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]}]', '100 - avg by(node_id) (rate(node_cpu_seconds_total{mode="idle", ${node_id}}[2m])) * 100 ${opt} ${value}', 0, NULL, NULL, '2023-11-01 15:45:59.114137+08', '2023-11-01 15:45:59.114137+08');
INSERT INTO "public"."tbl_omc_alert_metric" ("id", "group_id", "metric_name", "label", "duration_time", "level", "message", "metric_key", "alert_condition_display_statement", "alert_condition_param", "data_condition_label", "data_filters", "prom_content", "status", "bp_id", "user_id", "create_time", "update_time") VALUES ('200', '3', '节点CPU使用率', NULL, 10, 3, '站点: {{$labels.site_id}，节点: {{$labels.node_id}} CPU使用率大于 85 %，当前值 {{ printf "%.2f" $value }}%', 'node_cpu_seconds_total', '当节点CPU使用率 >= 85 %时，满足告警条件。', NULL, NULL, NULL, '100 - avg by(instance, instance_id, instance_name, site_id) (rate(node_cpu_seconds_total{mode=\"idle\"}[2m])) * 100 >= 85', 0, NULL, NULL, '2023-11-20 11:43:26.264268+08', '2023-11-20 11:43:26.264268+08');
INSERT INTO "public"."tbl_omc_alert_metric" ("id", "group_id", "metric_name", "label", "duration_time", "level", "message", "metric_key", "alert_condition_display_statement", "alert_condition_param", "data_condition_label", "data_filters", "prom_content", "status", "bp_id", "user_id", "create_time", "update_time") VALUES ('202', '3', '节点Memory使用率', NULL, 10, 3, '站点: {{$labels.site_id}}，节点: {{$labels.node_id}} Memory 使用率大于 85 %，当前值 {{ printf "%.2f" $value }}%', 'node_memory_MemAvailable_bytes', '当节点Memory使用率 >= 85 %时，满足告警条件。', NULL, NULL, NULL, '100 - node_memory_MemAvailable_bytes{} / node_memory_MemTotal_bytes{} * 100 >= 85', 0, NULL, NULL, '2023-11-20 11:50:56.746455+08', '2023-11-20 11:50:56.746455+08');
INSERT INTO "public"."tbl_omc_alert_metric" ("id", "group_id", "metric_name", "label", "duration_time", "level", "message", "metric_key", "alert_condition_display_statement", "alert_condition_param", "data_condition_label", "data_filters", "prom_content", "status", "bp_id", "user_id", "create_time", "update_time") VALUES ('201', '3', '节点Disk使用率', NULL, 10, 3, '站点: {{$labels.site_id}}，节点: {{$labels.node_id}} Disk 使用率大于 85 %，当前值 {{ printf "%.2f" $value }}%', 'node_filesystem_avail_bytes', '当节点Disk使用率 >= 85 %时，满足告警条件。', NULL, NULL, NULL, '100 - (sum(node_filesystem_avail_bytes) by (instance_id,  siteid, device) * 100) / sum(node_filesystem_size_bytes) by (  instance_id, site_id, device) >= 85', 0, NULL, NULL, '2023-11-20 11:50:14.286794+08', '2023-11-20 11:50:14.286794+08');
INSERT INTO "public"."tbl_omc_alert_metric" ("id", "group_id", "metric_name", "label", "duration_time", "level", "message", "metric_key", "alert_condition_display_statement", "alert_condition_param", "data_condition_label", "data_filters", "prom_content", "status", "bp_id", "user_id", "create_time", "update_time") VALUES ('4', '1', '节点磁盘使用率', NULL, 10, 2, '节点 {{ $labels.node_id }} 磁盘 {{ $labels.device }} 使用率{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%，当前磁盘使用率 {{ printf "%.2f" $value }}%', 'node_disk_usage', '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', '[{"labelName":"metrics_name","showType":"text","detail":{"value":"节点磁盘使用率"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":90,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', '[{"label":"node_id","labelName":"节点","minWidth":160,"maxWidth":200,"children":{"label":"device","labelName":"磁盘","minWidth":160,"maxWidth":200,"children":null}}]', '[{"filterLabel":"node_id","filterDim":"node_id","filterDimName":"节点","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"device","filterDim":"device","filterDimName":"磁盘","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]}]', '100 - (sum(node_filesystem_avail_bytes{${node_id}, ${device}}) by (node_id, device) * 100) / sum(node_filesystem_size_bytes{${node_id}, ${device}}) by (node_id, device)  ${opt} ${value}', 0, NULL, NULL, '2023-11-01 16:16:54.852724+08', '2023-11-01 16:16:54.852724+08');
INSERT INTO "public"."tbl_omc_alert_metric" ("id", "group_id", "metric_name", "label", "duration_time", "level", "message", "metric_key", "alert_condition_display_statement", "alert_condition_param", "data_condition_label", "data_filters", "prom_content", "status", "bp_id", "user_id", "create_time", "update_time") VALUES ('301', '4', '容器内存使用率', NULL, 10, 3, '节点: {{$labels.node_id}}  / 容器: {{$labels.name}}  (容器id:{{$labels.container_ref_id}}) 内存使用率 {{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%, 当前值{{ printf "%.2f" $value }}%', 'container_memory_usage', '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', '[{"labelName":"metrics_name","showType":"text","detail":{"value":"容器内存使用率"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":80,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', '[{"label":"node_id","labelName":"节点id","minWidth":160,"maxWidth":200,"children":{"label":"name","labelName":"容器名","minWidth":160,"maxWidth":200}}]', '[{"filterLabel":"node_id","filterDim":"node_id","filterDimName":"节点id","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"name","filterDim":"name","filterDimName":"容器名","valueType":"string","opt":"ALL","supportOpts":[{"label":"等于","value":"="},{"label":"不等于","value":"!="},{"label":"正则匹配","value":"=~"},{"label":"正则不匹配","value":"!~"},{"label":"遍历","value":"ALL"}],"value":"","showFilter":true,"values":[],"staticValue":false}]', '(sum(container_memory_working_set_bytes {name=~".+",image!="",id!="",${node_id}, ${name}} ) BY (node_id, name,container_ref_id) / sum(container_spec_memory_limit_bytes {name=~".+",image!="",id!="",${node_id}, ${name}} > 0) BY (node_id, name,container_ref_id) * 100)  ${opt} ${value}', 0, NULL, NULL, '2023-11-17 16:05:00.88865+08', '2023-11-17 16:05:00.88865+08');
INSERT INTO "public"."tbl_omc_alert_metric" ("id", "group_id", "metric_name", "label", "duration_time", "level", "message", "metric_key", "alert_condition_display_statement", "alert_condition_param", "data_condition_label", "data_filters", "prom_content", "status", "bp_id", "user_id", "create_time", "update_time") VALUES ('302', '4', '容器磁盘使用率', NULL, 10, 3, '节点: {{$labels.node_id}}  / 容器: {{$labels.name}}  (容器id:{{$labels.container_ref_id}}) 磁盘使用率 {{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%, 当前值{{ printf "%.2f" $value }}%', 'container_fs_inodes_free', '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', '[{"labelName":"metrics_name","showType":"text","detail":{"value":"容器磁盘使用率"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":80,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', '[{"label":"node_id","labelName":"节点id","minWidth":160,"maxWidth":200,"children":{"label":"name","labelName":"容器名","minWidth":160,"maxWidth":200}}]', '[{"filterLabel":"node_id","filterDim":"node_id","filterDimName":"节点id","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"name","filterDim":"name","filterDimName":"容器名","valueType":"string","opt":"ALL","supportOpts":[{"label":"等于","value":"="},{"label":"不等于","value":"!="},{"label":"正则匹配","value":"=~"},{"label":"正则不匹配","value":"!~"},{"label":"遍历","value":"ALL"}],"value":"","showFilter":true,"values":[],"staticValue":false}]', '(1 - (sum(container_fs_inodes_free{name=~".+",image!="",id!="",${node_id}, ${name}}) BY (node_id, name,container_ref_id) / sum(container_fs_inodes_total) BY (node_id, name,container_ref_id))) * 100 ${opt} ${value}', 0, NULL, NULL, '2023-11-17 16:05:00.88865+08', '2023-11-17 16:05:00.88865+08');
INSERT INTO "public"."tbl_omc_alert_metric" ("id", "group_id", "metric_name", "label", "duration_time", "level", "message", "metric_key", "alert_condition_display_statement", "alert_condition_param", "data_condition_label", "data_filters", "prom_content", "status", "bp_id", "user_id", "create_time", "update_time") VALUES ('303', '4', '容器离线', NULL, 10, 3, '节点: {{$labels.node_id}}  / 容器: {{$labels.name}}  (容器id:{{$labels.container_ref_id}}) 容器已被删除或停止', 'container_last_seen', '当 ${metrics_name} ${opt} ${value}秒 时，满足告警条件。', '[{"labelName":"metrics_name","showType":"text","detail":{"value":"离线时间"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":80,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', '[{"label":"node_id","labelName":"节点id","minWidth":160,"maxWidth":200,"children":{"label":"name","labelName":"容器名","minWidth":160,"maxWidth":200}}]', '[{"filterLabel":"node_id","filterDim":"node_id","filterDimName":"节点id","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"name","filterDim":"name","filterDimName":"容器名","valueType":"string","opt":"ALL","supportOpts":[{"label":"等于","value":"="},{"label":"不等于","value":"!="},{"label":"正则匹配","value":"=~"},{"label":"正则不匹配","value":"!~"},{"label":"遍历","value":"ALL"}],"value":"","showFilter":true,"values":[],"staticValue":false}]', 'time() - container_last_seen{name=~".+",image!="",id!="",${node_id}, ${name}} ${opt} ${value}', 0, NULL, NULL, '2023-11-17 16:05:00.88865+08', '2023-11-17 16:05:00.88865+08');
INSERT INTO "public"."tbl_omc_alert_metric" ("id", "group_id", "metric_name", "label", "duration_time", "level", "message", "metric_key", "alert_condition_display_statement", "alert_condition_param", "data_condition_label", "data_filters", "prom_content", "status", "bp_id", "user_id", "create_time", "update_time") VALUES ('300', '4', '容器cpu使用率', NULL, 10, 3, '节点: {{$labels.node_id}}  / 容器: {{$labels.name}}  (容器id:{{$labels.container_ref_id}}) CPU使用率{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%, 当前值{{ printf "%.2f" $value }}%', 'container_cpu_usage', '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', '[{"labelName":"metrics_name","showType":"text","detail":{"value":"容器CPU使用率"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":80,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', '[{"label":"node_id","labelName":"节点","minWidth":160,"maxWidth":200,"children":{"label":"name","labelName":"容器","minWidth":160,"maxWidth":200}}]', '[{"filterLabel":"node_id","filterDim":"node_id","filterDimName":"节点id","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"name","filterDim":"name","filterDimName":"容器名","valueType":"string","opt":"ALL","supportOpts":[{"label":"等于","value":"="},{"label":"不等于","value":"!="},{"label":"正则匹配","value":"=~"},{"label":"正则不匹配","value":"!~"},{"label":"遍历","value":"ALL"}],"value":"","showFilter":true,"values":[],"staticValue":false}]', '(sum(rate(container_cpu_usage_seconds_total{name=~".+",image!="",id!="",${node_id}, ${name}}[3m])) BY (node_id, name,container_ref_id) * 100) ${opt} ${value}', 0, NULL, NULL, '2023-11-17 16:04:25.697165+08', '2023-11-17 16:04:25.697165+08');


--INSERT INTO "public"."tbl_omc_prometheus" ("id", "name", "type", "status", "lables", "auth", "region_id", "site_id", "node_id", "is_global", "system_default", "extra", "bp_id",
--                                            "user_id", "create_time", "update_time") VALUES ('1', 'prometheus server', 0, '1', NULL, NULL, NULL, NULL, NULL, 't', 't', NULL,
--                                                                                               NULL, NULL, '2023-11-08 11:15:38+08', '2023-11-08 11:15:40+08');


-- monitor stack template
INSERT INTO "public"."tbl_stack_template_base_info" ("id", "name", "user_id", "bp_id", "logo_url", "vendor", "description", "labels", "status", "create_time", "update_time") VALUES ('471f94114ffd42f8b65bd051fb02c361', 'node-monitor-system-default-stack', '39937079-99fe-4cd8-881f-04ca8c4fe09d', NULL, '', 'system', '轻量级节点exporter应用，包含node exporter和cAdvisor exporter，用于节点和容器监控数据的采集。', '["prometheus_monitor","service_light_node","ANY_IN_SITE"]', 1, '2023-11-07 11:15:16.321+08', '2023-12-21 15:46:19.311+08');
INSERT INTO "public"."tbl_stack_template_base_info" ("id", "name", "user_id", "bp_id", "logo_url", "vendor", "description", "labels", "status", "create_time", "update_time") VALUES ('8127343c45674eaaaa0c3d7a2ba34cdf', 'nvidia-gpu', '39937079-99fe-4cd8-881f-04ca8c4fe09d', NULL, '', NULL, '轻量级节点nvidia gpu应用，包含nvidia gpu，用于nvidia gpu监控数据的采集。', '["prometheus_monitor","resource_gpu"]', 1, '2023-12-02 17:07:15.09+08', '2023-12-16 15:18:29.707+08');
INSERT INTO "public"."tbl_stack_template_base_info" ("id", "name", "user_id", "bp_id", "logo_url", "vendor", "description", "labels", "status", "create_time", "update_time") VALUES ('adc771693aa04d1a8d2c30cb6be5c979', 'prometheus agent', '39937079-99fe-4cd8-881f-04ca8c4fe09d', NULL, '', NULL, 'prometheus agent 模式应用模板。', '["prometheus-agent","one_in_site","prometheus_monitor"]', 1, '2023-12-21 17:03:22.433+08', '2023-12-27 15:44:46.8+08');

INSERT INTO "public"."tbl_stack_template_info" ("template_id", "root_id", "version", "aos_type", "is_used", "content_type", "stack_compose", "justice_compose", "show_inputs", "status", "description", "labels", "create_time", "update_time") VALUES ('4fd015a1568b4daaab0118914cb47f9e', '471f94114ffd42f8b65bd051fb02c361', 'v1', 'docker-compose', 'f', 'yaml', 'version: ''3''

services:

  nodeexporter:
    image: lnjoying/node-exporter:v1.6.1
    container_name: lnjoying-nodeexporter
    volumes:
      - /proc:/host/proc:ro
      - /sys:/host/sys:ro
      - /:/rootfs:ro
    command:
      - ''--path.procfs=/host/proc''
      - ''--path.rootfs=/rootfs''
      - ''--path.sysfs=/host/sys''
      - ''--collector.filesystem.mount-points-exclude=^/(sys|proc|dev|host|etc)($$|/)''
    restart: unless-stopped
    ports:
      - "${EXPOSE_PORT_HTTP_LIGHT_NODE}:9100"
    networks:
      - lnjoying-exporter-net
    labels:
      org.label-schema.group: "lnjoying"

  cadvisor:
    image: lnjoying/cadvisor:v0.47.2
    container_name: lnjoying-cadvisor
    privileged: true
    devices:
      - /dev/kmsg:/dev/kmsg
    volumes:
      - /:/rootfs:ro
      - /var/run:/var/run:ro
      - /sys:/sys:ro
      - /var/lib/docker/:/var/lib/docker:ro
      - /cgroup:/cgroup:ro
    command:
      - ''--store_container_labels=false''
      - ''--whitelisted_container_labels=JDS_UID,JDS_UUID,JDS_BPID''
      - ''--docker_only=true''
    restart: unless-stopped
    ports:
      - "${EXPOSE_PORT_HTTP_CADVISOR}:8080"
    networks:
      - lnjoying-exporter-net
    labels:
      org.label-schema.group: "lnjoying"

networks:
  lnjoying-exporter-net:
    driver: bridge', 'basic:
  name: "exporter for node template"
  version: "v1.0"
  description: "exporter for node template"
  uuid: exporter_for_node_template_20231104
  minimum_justice_version: v1.0
  input_params:
    - variable: EXPOSE_PORT_HTTP_LIGHT_NODE
      description: " node exporter listen address "
      label: "节点采集端口"
      type: "string"
      required: true
      default_value: ''39100''

    - variable: EXPOSE_PORT_HTTP_CADVISOR
      description: "cadvisor exporter listen address "
      label: "容器采集端口"
      type: "string"
      required: true
      default_value: ''38080''', '[{"variable":"EXPOSE_PORT_HTTP_LIGHT_NODE","description":" node exporter listen address ","label":"端口","type":"string","required":true,"default_value":"39100","immutable":false},{"variable":"EXPOSE_PORT_HTTP_CADVISOR","description":"cadvisor exporter listen address ","label":"端口","type":"string","required":true,"default_value":"38080","immutable":false}]', 1, '轻量级节点exporter应用，包含node exporter和cAdvisor exporter，用于节点和容器监控数据的采集。', '["prometheus_monitor","service_light_node","ANY_IN_SITE"]', '2023-11-07 11:15:16.441+08', '2023-12-21 15:46:19.252+08');


INSERT INTO "public"."tbl_stack_template_info" ("template_id", "root_id", "version", "aos_type", "is_used", "content_type", "stack_compose", "justice_compose", "show_inputs",
                                                "status", "description", "labels", "create_time", "update_time") VALUES ('5a3924f2073044b59d09cebe1267c821', '8127343c45674eaaaa0c3d7a2ba34cdf', '1.0.0', 'docker-compose', 'f', 'yaml', 'version: ''3''

services:
    nvidia_gpu_exporter:
        container_name: nvidia_smi_exporter
        restart: unless-stopped
        devices:
            - /dev:/dev
        volumes:
            - /usr/lib/x86_64-linux-gnu/libnvidia-ml.so:/usr/lib/x86_64-linux-gnu/libnvidia-ml.so
            - /usr/lib/x86_64-linux-gnu/libnvidia-ml.so.1:/usr/lib/x86_64-linux-gnu/libnvidia-ml.so.1
            - /usr/bin/nvidia-smi:/usr/bin/nvidia-smi
        ports:
            - ${EXPOSE_PORT_HTTP_GPU}:9835
        image: utkuozdemir/nvidia_gpu_exporter:1.2.0', 'basic:
  name: "exporter for nvidia gpu"
  version: "v1.0"
  description: "exporter for nvidia gpu"
  uuid: exporter_for_nvidia_gpu_template_20231104
  minimum_justice_version: v1.0
  input_params:
    - variable: EXPOSE_PORT_HTTP_GPU
      description: " nvidia gpu listen address "
      label: "采集端口"
      type: "string"
      required: true
      default_value: ''19835''', '[{"variable":"EXPOSE_PORT_HTTP_GPU","description":" nvidia gpu listen address ","label":"端口","type":"string","required":true,"default_value":"19835","immutable":false}]', 1, '轻量级节点nvidia gpu应用，包含nvidia gpu，用于nvidia gpu监控数据的采集。', '["prometheus_monitor","resource_gpu"]', '2023-12-02 17:15:17.286+08', '2023-12-16 15:18:29.633+08');

INSERT INTO "public"."tbl_stack_template_info" ("template_id", "root_id", "version", "aos_type", "is_used", "content_type", "stack_compose", "justice_compose", "show_inputs", "status", "description", "labels", "create_time", "update_time") VALUES ('531a62258e114ee3b162797305db6fd9', 'adc771693aa04d1a8d2c30cb6be5c979', 'v1.0', 'docker-compose', 'f', 'yaml', 'version: ''3''

networks:
  monitor-net:
    driver: bridge

services:

  prometheus:
    image: lnjoying/prometheus:v2.47.2
    container_name: lnjoying-prometheus-agent
    volumes:
      - /var/lnjoying/monitor/prometheus:/etc/prometheus
      - /var/lnjoying/monitor/prometheus/data:/prometheus
      - ${prometheus_yml}:/etc/prometheus/prometheus.yml
      - /var/lnjoying/monitor/target_files:/root/monitor/target_files
    command:
      - ''--config.file=/etc/prometheus/prometheus.yml''
      - ''--web.console.libraries=/etc/prometheus/console_libraries''
      - ''--web.console.templates=/etc/prometheus/consoles''
      - ''--web.enable-lifecycle''
      - ''--storage.tsdb.retention.time=2d''
      - ''--storage.tsdb.path=/prometheus''
      #- "--enable-feature=agent"
    restart: unless-stopped
    ports:
      - "${EXPOSE_PORT_HTTP_PROMETHEUS_AGENT}:9090"
    user: root
    expose:
      - 9090
    networks:
      - monitor-net
    labels:
      org.label-schema.group: "lnjoying"', 'basic:
  name: prometheus_agent_params
  version: ''1.0''
  description: prometheus yml
  uuid: 1-1-1-1
  minimum_justice_version: v1.0
  input_params:
    - variable: prometheus_yml
      description: "选用system/prometheus-agent配置文件"
      label: prometheus agent配置文件
      type: CfgOption
      required: true
      default_value: ''''
    - variable: EXPOSE_PORT_HTTP_PROMETHEUS_AGENT
      description: "node exporter listen address "
      label: "prometheus agent端口"
      type: "string"
      required: true
      default_value: ''39090''
', '[{"variable":"prometheus_yml","description":"选用system/prometheus-agent配置文件","label":"prometheus agent配置文件","type":"CfgOption","required":true,"default_value":"","immutable":false},{"variable":"EXPOSE_PORT_HTTP_PROMETHEUS_AGENT","description":"node exporter listen address ","label":"prometheus agent端口","type":"string","required":true,"default_value":"39090","immutable":false},{"variable":"REMOTE_WRITE_URL","description":"prometheus remote write","label":"远程写入地址","type":"string","required":true,"default_value":"http://localhost:39090/api/v1/write","immutable":false}]', 1, 'prometheus agent 模式应用模板。', '["prometheus-agent","one_in_site","prometheus_monitor"]', '2023-12-21 17:03:22.526+08', '2023-12-27 15:44:46.786+08');

--- 20240423 update
INSERT INTO "public"."tbl_omc_alert_group" ("id", "name", "description", "status", "bp_id", "user_id", "create_time", "update_time") VALUES ('12', 'nextstack-虚拟机', 'nextstack 虚拟机', 0, NULL, NULL, '2024-03-16 15:16:07.319755+08', '2024-03-16 15:16:07.319755+08');
INSERT INTO "public"."tbl_omc_alert_group" ("id", "name", "description", "status", "bp_id", "user_id", "create_time", "update_time") VALUES ('11', 'nextstack-计算节点', 'nextstack 计算节点', 0, NULL, NULL, '2024-03-16 15:15:22.195881+08', '2024-03-16 15:15:22.195881+08');
INSERT INTO "public"."tbl_omc_alert_group" ("id", "name", "description", "status", "bp_id", "user_id", "create_time", "update_time") VALUES ('13', 'nextstack-计算节点-GPU', 'nextstack 计算节点 GPU', 0, NULL, NULL, '2024-03-26 19:32:18.142397+08', '2024-03-26 19:32:18.142397+08');
INSERT INTO "public"."tbl_omc_alert_group" ("id", "name", "description", "status", "bp_id", "user_id", "create_time", "update_time") VALUES ('14', 'nextstack-虚拟机-GPU', 'nextstack 虚拟机 GPU', 0, NULL, NULL, '2024-03-26 19:32:39.35748+08', '2024-03-26 19:32:39.35748+08');

INSERT INTO "public"."tbl_omc_alert_metric" ("id", "group_id", "metric_name", "label", "duration_time", "level", "message", "metric_key", "alert_condition_display_statement", "alert_condition_param", "data_condition_label", "data_filters", "prom_content", "status", "bp_id", "user_id", "create_time", "update_time") VALUES ('1403', '14', '虚拟机GPU温度', NULL, 10, 3, 'nextstack云: {{$labels.cloud_id}}，虚拟机: {{$labels.instanceId}} GPU温度{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}，当前GPU温度 {{ printf "%.2f" $value }}', NULL, '当 ${metrics_name} ${opt} ${value} 时，满足告警条件。', '[{"labelName":"metrics_name","showType":"text","detail":{"value":"GPU温度"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":90,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', '[{"label":"cloud_id","labelName":"云id","minWidth":160,"maxWidth":200,"children":{"label":"instanceId","labelName":"虚拟机id","minWidth":160,"maxWidth":200}}]', '[{"filterLabel":"cloud_id","filterDim":"cloud_id","filterDimName":"云id","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"instanceId","filterDim":"instanceId","filterDimName":"虚拟机id","valueType":"string","opt":"ALL","supportOpts":[{"label":"等于","value":"="},{"label":"不等于","value":"!="},{"label":"正则匹配","value":"=~"},{"label":"正则不匹配","value":"!~"},{"label":"遍历","value":"ALL"}],"value":"","showFilter":true,"values":[],"staticValue":false}]', 'nvidia_smi_temperature_gpu{${cloud_id},${instanceId}}  ${opt} ${value}', 0, NULL, NULL, '2024-03-26 19:35:10.684073+08', '2024-03-26 19:35:10.684073+08');
INSERT INTO "public"."tbl_omc_alert_metric" ("id", "group_id", "metric_name", "label", "duration_time", "level", "message", "metric_key", "alert_condition_display_statement", "alert_condition_param", "data_condition_label", "data_filters", "prom_content", "status", "bp_id", "user_id", "create_time", "update_time") VALUES ('1402', '14', '虚拟机GPU显存使用率', NULL, 10, 3, 'nextstack云: {{$labels.cloud_id}}，虚拟机: {{$labels.instanceId}} GPU显存使用率{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%，当前GPU显存使用率 {{ printf "%.2f" $value }}%', NULL, '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', '[{"labelName":"metrics_name","showType":"text","detail":{"value":"GPU显存使用率"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":90,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', '[{"label":"cloud_id","labelName":"云id","minWidth":160,"maxWidth":200,"children":{"label":"instanceId","labelName":"虚拟机id","minWidth":160,"maxWidth":200}}]', '[{"filterLabel":"cloud_id","filterDim":"cloud_id","filterDimName":"云id","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"instanceId","filterDim":"instanceId","filterDimName":"虚拟机id","valueType":"string","opt":"ALL","supportOpts":[{"label":"等于","value":"="},{"label":"不等于","value":"!="},{"label":"正则匹配","value":"=~"},{"label":"正则不匹配","value":"!~"},{"label":"遍历","value":"ALL"}],"value":"","showFilter":true,"values":[],"staticValue":false}]', 'nvidia_smi_utilization_memory_ratio{${cloud_id},${instanceId}}  * 100  ${opt} ${value}', 0, NULL, NULL, '2024-03-26 19:35:00.013832+08', '2024-03-26 19:35:00.013832+08');
INSERT INTO "public"."tbl_omc_alert_metric" ("id", "group_id", "metric_name", "label", "duration_time", "level", "message", "metric_key", "alert_condition_display_statement", "alert_condition_param", "data_condition_label", "data_filters", "prom_content", "status", "bp_id", "user_id", "create_time", "update_time") VALUES ('1401', '14', '虚拟机GPU使用率', NULL, 10, 3, 'nextstack云: {{$labels.cloud_id}}，虚拟机: {{$labels.instanceId}} GPU使用率{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%，当前GPU使用率 {{ printf "%.2f" $value }}%', NULL, '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', '[{"labelName":"metrics_name","showType":"text","detail":{"value":"GPU使用率"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":90,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', '[{"label":"cloud_id","labelName":"云id","minWidth":160,"maxWidth":200,"children":{"label":"instanceId","labelName":"虚拟机id","minWidth":160,"maxWidth":200}}]', '[{"filterLabel":"cloud_id","filterDim":"cloud_id","filterDimName":"云id","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"instanceId","filterDim":"instanceId","filterDimName":"虚拟机id","valueType":"string","opt":"ALL","supportOpts":[{"label":"等于","value":"="},{"label":"不等于","value":"!="},{"label":"正则匹配","value":"=~"},{"label":"正则不匹配","value":"!~"},{"label":"遍历","value":"ALL"}],"value":"","showFilter":true,"values":[],"staticValue":false}]', 'nvidia_smi_utilization_gpu_ratio{${cloud_id},${instanceId}}  * 100  ${opt} ${value}', 0, NULL, NULL, '2024-03-26 19:34:55.685682+08', '2024-03-26 19:34:55.685682+08');
INSERT INTO "public"."tbl_omc_alert_metric" ("id", "group_id", "metric_name", "label", "duration_time", "level", "message", "metric_key", "alert_condition_display_statement", "alert_condition_param", "data_condition_label", "data_filters", "prom_content", "status", "bp_id", "user_id", "create_time", "update_time") VALUES ('1303', '13', '计算节点GPU温度', NULL, 10, 3, 'nextstack云: {{$labels.cloud_id}}，计算节点: {{$labels.instance}} GPU温度{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}，当前GPU温度 {{ printf "%.2f" $value }}', NULL, '当 ${metrics_name} ${opt} ${value} 时，满足告警条件。', '[{"labelName":"metrics_name","showType":"text","detail":{"value":"GPU温度"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":90,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', '[{"label":"cloud_id","labelName":"云id","minWidth":160,"maxWidth":200,"children":{"label":"nodeId","labelName":"计算节点id","minWidth":160,"maxWidth":200}}]', '[{"filterLabel":"cloud_id","filterDim":"cloud_id","filterDimName":"云id","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"nodeId","filterDim":"nodeId","filterDimName":"计算节点id","valueType":"string","opt":"ALL","supportOpts":[{"label":"等于","value":"="},{"label":"不等于","value":"!="},{"label":"正则匹配","value":"=~"},{"label":"正则不匹配","value":"!~"},{"label":"遍历","value":"ALL"}],"value":"","showFilter":true,"values":[],"staticValue":false}]', 'nvidia_smi_temperature_gpu{${cloud_id},${nodeId}}  ${opt} ${value}', 0, NULL, NULL, '2024-03-26 19:34:50.955362+08', '2024-03-26 19:34:50.955362+08');
INSERT INTO "public"."tbl_omc_alert_metric" ("id", "group_id", "metric_name", "label", "duration_time", "level", "message", "metric_key", "alert_condition_display_statement", "alert_condition_param", "data_condition_label", "data_filters", "prom_content", "status", "bp_id", "user_id", "create_time", "update_time") VALUES ('1302', '13', '计算节点GPU显存使用率', NULL, 10, 3, 'nextstack云: {{$labels.cloud_id}}，计算节点: {{$labels.instance}} GPU显存使用率{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%，当前GPU显存使用率 {{ printf "%.2f" $value }}%', NULL, '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', '[{"labelName":"metrics_name","showType":"text","detail":{"value":"GPU显存使用率"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":90,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', '[{"label":"cloud_id","labelName":"云id","minWidth":160,"maxWidth":200,"children":{"label":"nodeId","labelName":"计算节点id","minWidth":160,"maxWidth":200}}]', '[{"filterLabel":"cloud_id","filterDim":"cloud_id","filterDimName":"云id","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"nodeId","filterDim":"nodeId","filterDimName":"计算节点id","valueType":"string","opt":"ALL","supportOpts":[{"label":"等于","value":"="},{"label":"不等于","value":"!="},{"label":"正则匹配","value":"=~"},{"label":"正则不匹配","value":"!~"},{"label":"遍历","value":"ALL"}],"value":"","showFilter":true,"values":[],"staticValue":false}]', 'nvidia_smi_utilization_memory_ratio{${cloud_id},${nodeId}}  * 100  ${opt} ${value}', 0, NULL, NULL, '2024-03-26 19:34:46.185629+08', '2024-03-26 19:34:46.185629+08');
INSERT INTO "public"."tbl_omc_alert_metric" ("id", "group_id", "metric_name", "label", "duration_time", "level", "message", "metric_key", "alert_condition_display_statement", "alert_condition_param", "data_condition_label", "data_filters", "prom_content", "status", "bp_id", "user_id", "create_time", "update_time") VALUES ('1301', '13', '计算节点GPU使用率', NULL, 10, 3, 'nextstack云: {{$labels.cloud_id}}，计算节点: {{$labels.instance}} GPU使用率{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%，当前GPU使用率 {{ printf "%.2f" $value }}%', NULL, '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', '[{"labelName":"metrics_name","showType":"text","detail":{"value":"GPU使用率"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":90,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', '[{"label":"cloud_id","labelName":"云id","minWidth":160,"maxWidth":200,"children":{"label":"nodeId","labelName":"计算节点id","minWidth":160,"maxWidth":200}}]', '[{"filterLabel":"cloud_id","filterDim":"cloud_id","filterDimName":"云id","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"nodeId","filterDim":"nodeId","filterDimName":"计算节点id","valueType":"string","opt":"ALL","supportOpts":[{"label":"等于","value":"="},{"label":"不等于","value":"!="},{"label":"正则匹配","value":"=~"},{"label":"正则不匹配","value":"!~"},{"label":"遍历","value":"ALL"}],"value":"","showFilter":true,"values":[],"staticValue":false}]', 'nvidia_smi_utilization_gpu_ratio{${cloud_id},${nodeId}} * 100 ${opt} ${value}', 0, NULL, NULL, '2024-03-26 19:34:40.380523+08', '2024-03-26 19:34:40.380523+08');
INSERT INTO "public"."tbl_omc_alert_metric" ("id", "group_id", "metric_name", "label", "duration_time", "level", "message", "metric_key", "alert_condition_display_statement", "alert_condition_param", "data_condition_label", "data_filters", "prom_content", "status", "bp_id", "user_id", "create_time", "update_time") VALUES ('1207', '12', '虚拟机在线状态', NULL, 10, 3, '虚拟机{{$labels.instanceId}}处于不可用状态', NULL, '当 ${metrics_name} 时，满足告警条件。', '[{"labelName":"metrics_name","showType":"text","detail":{"value":"实例离线"}}]', '[{"label":"instanceId","labelName":"虚拟机","minWidth":160,"maxWidth":200,"children":null}]', '[{"filterLabel":"instanceId","filterDim":"instanceId","filterDimName":"虚拟机","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]}]', 'libvirt_domain_state_code{ job="libvirt_server", ${instanceId}}==5 or libvirt_domain_state_code{ job="libvirt_server", ${instanceId}} ==6', 0, NULL, NULL, '2024-03-25 14:25:58.449307+08', '2024-03-25 14:25:58.449307+08');
INSERT INTO "public"."tbl_omc_alert_metric" ("id", "group_id", "metric_name", "label", "duration_time", "level", "message", "metric_key", "alert_condition_display_statement", "alert_condition_param", "data_condition_label", "data_filters", "prom_content", "status", "bp_id", "user_id", "create_time", "update_time") VALUES ('1206', '12', '虚拟机磁盘吞吐率', NULL, 10, 3, 'nextstack云: {{$labels.cloud_id}}，虚拟机: {{$labels.instanceId}} 磁盘IOPS{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%，当前磁盘IOPS {{ printf "%.2f" $value }}%', NULL, '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', '[{"labelName":"metrics_name","showType":"text","detail":{"value":"虚拟机磁盘吞吐率"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":90,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', '[{"label":"instanceId","labelName":"虚拟机","minWidth":160,"maxWidth":200,"children":null}]', '[{"filterLabel":"instanceId","filterDim":"instanceId","filterDimName":"虚拟机","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]}]', 'round((rate(libvirt_domain_block_stats_read_bytes_total{${instanceId}}[10m])+rate(libvirt_domain_block_stats_write_bytes_total{${instanceId}}[10m]))/1024/1024 ${opt} ${value}  , 0.01)', 0, NULL, NULL, '2024-03-25 14:25:51.333642+08', '2024-03-25 14:25:51.333642+08');
INSERT INTO "public"."tbl_omc_alert_metric" ("id", "group_id", "metric_name", "label", "duration_time", "level", "message", "metric_key", "alert_condition_display_statement", "alert_condition_param", "data_condition_label", "data_filters", "prom_content", "status", "bp_id", "user_id", "create_time", "update_time") VALUES ('1205', '12', '虚拟机磁盘IOPS', NULL, 10, 3, 'nextstack云: {{$labels.cloud_id}，虚拟机: {{$labels.instanceId}} 磁盘IOPS{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%，当前磁盘IOPS {{ printf "%.2f" $value }}%', NULL, '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', '[{"labelName":"metrics_name","showType":"text","detail":{"value":"虚拟机磁盘IOPS"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":90,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', '[{"label":"instanceId","labelName":"虚拟机","minWidth":160,"maxWidth":200,"children":null}]', '[{"filterLabel":"instanceId","filterDim":"instanceId","filterDimName":"虚拟机","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]}]', 'round(rate(libvirt_domain_block_stats_read_requests_total{${instanceId}}[10m])+rate(libvirt_domain_block_stats_write_requests_total{${instanceId}}[10m]) ${opt} ${value}  , 0.01)', 0, NULL, NULL, '2024-03-25 14:25:44.169758+08', '2024-03-25 14:25:44.169758+08');
INSERT INTO "public"."tbl_omc_alert_metric" ("id", "group_id", "metric_name", "label", "duration_time", "level", "message", "metric_key", "alert_condition_display_statement", "alert_condition_param", "data_condition_label", "data_filters", "prom_content", "status", "bp_id", "user_id", "create_time", "update_time") VALUES ('1204', '12', '虚拟机网络吞吐率', NULL, 10, 3, 'nextstack云: {{$labels.cloud_id}}，虚拟机: {{$labels.instanceId}} 网络吞吐率{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%，当前网络吞吐率 {{ printf "%.2f" $value }}%', NULL, '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', '[{"labelName":"metrics_name","showType":"text","detail":{"value":"虚拟机网络吞吐率"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":90,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', '[{"label":"instanceId","labelName":"虚拟机","minWidth":160,"maxWidth":200,"children":null}]', '[{"filterLabel":"instanceId","filterDim":"instanceId","filterDimName":"虚拟机","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]}]', 'round((rate(libvirt_domain_interface_stats_receive_bytes_total{${instanceId}}[10m])+rate(libvirt_domain_interface_stats_transmit_bytes_total{${instanceId}}[10m]))/1024/1024 ${opt} ${value}  , 0.01)', 0, NULL, NULL, '2024-03-25 14:25:36.685417+08', '2024-03-25 14:25:36.685417+08');
INSERT INTO "public"."tbl_omc_alert_metric" ("id", "group_id", "metric_name", "label", "duration_time", "level", "message", "metric_key", "alert_condition_display_statement", "alert_condition_param", "data_condition_label", "data_filters", "prom_content", "status", "bp_id", "user_id", "create_time", "update_time") VALUES ('1203', '12', '虚拟机文件系统使用率', NULL, 10, 3, 'nextstack云: {{$labels.cloud_id}}，虚拟机: {{$labels.instance_id}} 文件系统使用率{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%，当前计算节点文件系统使用率 {{ printf "%.2f" $value }}%', NULL, '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', '[{"labelName":"metrics_name","showType":"text","detail":{"value":"虚拟机文件系统使用率"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":90,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', '[{"label":"instanceId","labelName":"虚拟机","minWidth":160,"maxWidth":200,"children":null}]', '[{"filterLabel":"instanceId","filterDim":"instanceId","filterDimName":"虚拟机","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]}]', 'round(ceil(libvirt_domain_filesystem_stats_used_percent{${instanceId}}*100) ${opt} ${value}    , 0.01)', 0, NULL, NULL, '2024-03-25 14:25:29.32883+08', '2024-03-25 14:25:29.32883+08');
INSERT INTO "public"."tbl_omc_alert_metric" ("id", "group_id", "metric_name", "label", "duration_time", "level", "message", "metric_key", "alert_condition_display_statement", "alert_condition_param", "data_condition_label", "data_filters", "prom_content", "status", "bp_id", "user_id", "create_time", "update_time") VALUES ('1202', '12', '虚拟机内存使用率', NULL, 10, 3, 'nextstack云: {{$labels.cloud_id}}，虚拟机: {{$labels.instance_id}} 内存使用率{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%，当前内存使用率 {{ printf "%.2f" $value }}%', NULL, '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', '[{"labelName":"metrics_name","showType":"text","detail":{"value":"虚拟机内存使用率"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":90,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', '[{"label":"instanceId","labelName":"虚拟机","minWidth":160,"maxWidth":200,"children":null}]', '[{"filterLabel":"instanceId","filterDim":"instanceId","filterDimName":"虚拟机","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]}]', 'round((1-libvirt_domain_stat_memory_usable_bytes{${instanceId}}/libvirt_domain_stat_memory_available_bytes{${instanceId}})*100 ${opt} ${value}  , 0.01)', 0, NULL, NULL, '2024-03-25 14:25:21.413899+08', '2024-03-25 14:25:21.413899+08');
INSERT INTO "public"."tbl_omc_alert_metric" ("id", "group_id", "metric_name", "label", "duration_time", "level", "message", "metric_key", "alert_condition_display_statement", "alert_condition_param", "data_condition_label", "data_filters", "prom_content", "status", "bp_id", "user_id", "create_time", "update_time") VALUES ('1201', '12', '虚拟机CPU使用率', NULL, 10, 3, 'nextstack云: {{$labels.cloud_id}}，虚拟机: {{$labels.instanceId}} CPU使用率{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%，当前CPU使用率 {{ printf "%.2f" $value }}%', NULL, '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', '[{"labelName":"metrics_name","showType":"text","detail":{"value":"虚拟机CPU使用率"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":90,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', '[{"label":"instanceId","labelName":"虚拟机","minWidth":160,"maxWidth":200,"children":null}]', '[{"filterLabel":"instanceId","filterDim":"instanceId","filterDimName":"虚拟机","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]}]', 'round(rate(libvirt_domain_info_cpu_time_seconds_total{${instanceId}}[10m])/(libvirt_domain_info_virtual_cpus{${instanceId}})*100 ${opt} ${value}  , 0.01)', 0, NULL, NULL, '2024-03-25 14:25:12.896074+08', '2024-03-25 14:25:12.896074+08');
INSERT INTO "public"."tbl_omc_alert_metric" ("id", "group_id", "metric_name", "label", "duration_time", "level", "message", "metric_key", "alert_condition_display_statement", "alert_condition_param", "data_condition_label", "data_filters", "prom_content", "status", "bp_id", "user_id", "create_time", "update_time") VALUES ('1107', '11', '计算节点实例在线状态', NULL, 10, 3, '计算节点{{$labels.instance}}处于不可用状态', NULL, '当 ${metrics_name} 时，满足告警条件。', '[{"labelName":"metrics_name","showType":"text","detail":{"value":"实例离线"}}]', '[{"label":"instance","labelName":"计算节点","minWidth":160,"maxWidth":200,"children":null}]', '[{"filterLabel":"instance","filterDim":"instance","filterDimName":"计算节点","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}] ,"placeholder":"ip:port,port为9100"}]', 'up{type="libvirt_node", ${instance}}==0', 0, NULL, NULL, '2024-03-23 15:50:00.393941+08', '2024-03-23 15:50:00.393941+08');
INSERT INTO "public"."tbl_omc_alert_metric" ("id", "group_id", "metric_name", "label", "duration_time", "level", "message", "metric_key", "alert_condition_display_statement", "alert_condition_param", "data_condition_label", "data_filters", "prom_content", "status", "bp_id", "user_id", "create_time", "update_time") VALUES ('1106', '11', '计算节点磁盘吞吐率', NULL, 10, 3, 'nextstack云: {{$labels.cloud_id}}，计算节点: {{$labels.instance}} 磁盘吞吐率{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%，当前磁盘吞吐率 {{ printf "%.2f" $value }}%', NULL, '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', '[{"labelName":"metrics_name","showType":"text","detail":{"value":"计算节点磁盘吞吐率"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":90,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', '[{"label":"cloud_id","labelName":"云id","minWidth":160,"maxWidth":200,"children":{"label":"instance","labelName":"计算节点","minWidth":160,"maxWidth":200}}]', '[{"filterLabel":"cloud_id","filterDim":"cloud_id","filterDimName":"云id","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"instance","filterDim":"instance","filterDimName":"计算节点","valueType":"string","opt":"ALL","supportOpts":[{"label":"等于","value":"="},{"label":"不等于","value":"!="},{"label":"正则匹配","value":"=~"},{"label":"正则不匹配","value":"!~"},{"label":"遍历","value":"ALL"}],"value":"","showFilter":true,"values":[],"staticValue":false,"placeholder":"ip:port,port为9100"}]', 'round((irate(node_disk_read_bytes_total{device !~ ''dm.*|nbd.*'',  ${cloud_id}  ${instance}}[5m])+irate(node_disk_written_bytes_total{device !~ ''dm.*|nbd.*'',  ${cloud_id}  ${instance}}[5m]))/1024/1024 ${opt} ${value}  , 0.01) ', 0, NULL, NULL, '2024-03-23 15:49:46.791444+08', '2024-03-23 15:49:46.791444+08');
INSERT INTO "public"."tbl_omc_alert_metric" ("id", "group_id", "metric_name", "label", "duration_time", "level", "message", "metric_key", "alert_condition_display_statement", "alert_condition_param", "data_condition_label", "data_filters", "prom_content", "status", "bp_id", "user_id", "create_time", "update_time") VALUES ('1105', '11', '计算节点磁盘IOPS', NULL, 10, 3, 'nextstack云: {{$labels.cloud_id}}，计算节点: {{$labels.instance}} 磁盘IOPS{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%，当前磁盘IOPS {{ printf "%.2f" $value }}%', NULL, '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', '[{"labelName":"metrics_name","showType":"text","detail":{"value":"计算节点磁盘IOPS"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":90,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', '[{"label":"cloud_id","labelName":"云id","minWidth":160,"maxWidth":200,"children":{"label":"instance","labelName":"计算节点","minWidth":160,"maxWidth":200}}]', '[{"filterLabel":"cloud_id","filterDim":"cloud_id","filterDimName":"云id","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"instance","filterDim":"instance","filterDimName":"计算节点","valueType":"string","opt":"ALL","supportOpts":[{"label":"等于","value":"="},{"label":"不等于","value":"!="},{"label":"正则匹配","value":"=~"},{"label":"正则不匹配","value":"!~"},{"label":"遍历","value":"ALL"}],"value":"","showFilter":true,"values":[],"staticValue":false,"placeholder":"ip:port,port为9100"}]', 'round(irate(node_disk_reads_completed_total{ device !~ ''dm.*|nbd.*'',  ${cloud_id}  ${instance}}[5m])+irate(node_disk_writes_completed_total{device !~ ''dm.*|nbd.*'',  ${cloud_id}  ${instance}}[5m]) ${opt} ${value}    , 0.01)', 0, NULL, NULL, '2024-03-23 15:49:41.702004+08', '2024-03-23 15:49:41.702004+08');
INSERT INTO "public"."tbl_omc_alert_metric" ("id", "group_id", "metric_name", "label", "duration_time", "level", "message", "metric_key", "alert_condition_display_statement", "alert_condition_param", "data_condition_label", "data_filters", "prom_content", "status", "bp_id", "user_id", "create_time", "update_time") VALUES ('1104', '11', '计算节点网络吞吐率', NULL, 10, 3, 'nextstack云: {{$labels.cloud_id}}，计算节点: {{$labels.instance}} 网络吞吐率{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%，当前网络吞吐率 {{ printf "%.2f" $value }}%', NULL, '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', '[{"labelName":"metrics_name","showType":"text","detail":{"value":"计算节点网络吞吐率"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":90,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', '[{"label":"cloud_id","labelName":"云id","minWidth":160,"maxWidth":200,"children":{"label":"instance","labelName":"计算节点","minWidth":160,"maxWidth":200}}]', '[{"filterLabel":"cloud_id","filterDim":"cloud_id","filterDimName":"云id","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"instance","filterDim":"instance","filterDimName":"计算节点","valueType":"string","opt":"ALL","supportOpts":[{"label":"等于","value":"="},{"label":"不等于","value":"!="},{"label":"正则匹配","value":"=~"},{"label":"正则不匹配","value":"!~"},{"label":"遍历","value":"ALL"}],"value":"","showFilter":true,"values":[],"staticValue":false,"placeholder":"ip:port,port为9100"}]', 'round((irate(node_network_receive_bytes_total{ device !~ ''br.*|v.*|ovs.*|lo*|docker.*|.*o'',  ${cloud_id}  ${instance}}[5m]) or irate(node_network_transmit_bytes_total{device !~ ''br.*|v.*|ovs.*|lo*|docker.*|.*o'',  ${cloud_id}  ${instance}}[5m]))/1024/1024 ${opt} ${value}   , 0.01)', 0, NULL, NULL, '2024-03-23 15:49:36.134082+08', '2024-03-23 15:49:36.134082+08');
INSERT INTO "public"."tbl_omc_alert_metric" ("id", "group_id", "metric_name", "label", "duration_time", "level", "message", "metric_key", "alert_condition_display_statement", "alert_condition_param", "data_condition_label", "data_filters", "prom_content", "status", "bp_id", "user_id", "create_time", "update_time") VALUES ('1103', '11', '计算节点文件系统使用率', NULL, 10, 3, 'nextstack云: {{$labels.cloud_id}}，计算节点: {{$labels.instance}} 计算节点文件系统使用率{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%，当前计算节点文件系统使用率 {{ printf "%.2f" $value }}%', NULL, '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', '[{"labelName":"metrics_name","showType":"text","detail":{"value":"计算节点文件系统使用率"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":90,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', '[{"label":"cloud_id","labelName":"云id","minWidth":160,"maxWidth":200,"children":{"label":"instance","labelName":"计算节点","minWidth":160,"maxWidth":200}}]', '[{"filterLabel":"cloud_id","filterDim":"cloud_id","filterDimName":"云id","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"instance","filterDim":"instance","filterDimName":"计算节点","valueType":"string","opt":"ALL","supportOpts":[{"label":"等于","value":"="},{"label":"不等于","value":"!="},{"label":"正则匹配","value":"=~"},{"label":"正则不匹配","value":"!~"},{"label":"遍历","value":"ALL"}],"value":"","showFilter":true,"values":[],"staticValue":false,"placeholder":"ip:port,port为9100"}]', 'round(100.0 - 100 * (node_filesystem_avail_bytes{device !~''tmpfs'',device!~''by-uuid'', ${cloud_id} ${instance}} / node_filesystem_size_bytes{device !~''tmpfs'',device!~''by-uuid'', ${cloud_id}  ${instance}}) ${opt} ${value}    , 0.01)', 0, NULL, NULL, '2024-03-23 15:49:25.793958+08', '2024-03-23 15:49:25.793958+08');
INSERT INTO "public"."tbl_omc_alert_metric" ("id", "group_id", "metric_name", "label", "duration_time", "level", "message", "metric_key", "alert_condition_display_statement", "alert_condition_param", "data_condition_label", "data_filters", "prom_content", "status", "bp_id", "user_id", "create_time", "update_time") VALUES ('1101', '11', '计算节点CPU使用率', NULL, 10, 3, 'nextstack云: {{$labels.cloud_id}}，计算节点: {{$labels.instance}} CPU使用率{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%，当前CPU使用率 {{ printf "%.2f" $value }}%', NULL, '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', '[{"labelName":"metrics_name","showType":"text","detail":{"value":"计算节点CPU使用率"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":90,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', '[{"label":"cloud_id","labelName":"云id","minWidth":160,"maxWidth":200,"children":{"label":"instance","labelName":"计算节点","minWidth":160,"maxWidth":200}}]', '[{"filterLabel":"cloud_id","filterDim":"cloud_id","filterDimName":"云id","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"instance","filterDim":"instance","filterDimName":"计算节点","valueType":"string","opt":"ALL","supportOpts":[{"label":"等于","value":"="},{"label":"不等于","value":"!="},{"label":"正则匹配","value":"=~"},{"label":"正则不匹配","value":"!~"},{"label":"遍历","value":"ALL"}],"value":"","showFilter":true,"values":[],"staticValue":false,"placeholder":"ip:port,port为9100"}]', 'round(100-(sum(increase(node_cpu_seconds_total{mode=''idle'',  ${cloud_id}  ${instance}}[5m]))by(instance)) /(sum(increase(node_cpu_seconds_total[5m]))by(instance))  ${opt} ${value}   ,0.01)', 0, NULL, NULL, '2024-03-23 15:48:53.176851+08', '2024-03-23 15:48:53.176851+08');
INSERT INTO "public"."tbl_omc_alert_metric" ("id", "group_id", "metric_name", "label", "duration_time", "level", "message", "metric_key", "alert_condition_display_statement", "alert_condition_param", "data_condition_label", "data_filters", "prom_content", "status", "bp_id", "user_id", "create_time", "update_time") VALUES ('1102', '11', '计算节点内存使用率', NULL, 10, 3, 'nextstack云: {{$labels.cloud_id}}，计算节点: {{$labels.instance}} 内存使用率{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%，当前内存使用率 {{ printf "%.2f" $value }}%', NULL, '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', '[{"labelName":"metrics_name","showType":"text","detail":{"value":"节点内存使用率"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":90,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', '[{"label":"cloud_id","labelName":"云id","minWidth":160,"maxWidth":200,"children":{"label":"instance","labelName":"计算节点","minWidth":160,"maxWidth":200}}]', '[{"filterLabel":"cloud_id","filterDim":"cloud_id","filterDimName":"云id","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"instance","filterDim":"instance","filterDimName":"计算节点id","valueType":"string","opt":"ALL","supportOpts":[{"label":"等于","value":"="},{"label":"不等于","value":"!="},{"label":"正则匹配","value":"=~"},{"label":"正则不匹配","value":"!~"},{"label":"遍历","value":"ALL"}],"value":"","showFilter":true,"values":[],"staticValue":false,"placeholder":"ip:port,port为9100"}]', 'round((1-(node_memory_MemAvailable_bytes{${cloud_id}  ${instance}}/node_memory_MemTotal_bytes{${cloud_id}  ${instance}}))*100 ${opt} ${value}  , 0.01)', 0, NULL, NULL, '2024-03-23 15:48:53.176851+08', '2024-03-23 15:48:53.176851+08');

--- 20240919 update
INSERT INTO "public"."tbl_omc_alert_group" ("id", "name", "description", "status", "bp_id", "user_id", "create_time", "update_time") VALUES ('15', '多云管理-资源池', '多云管理-资源池', 0, NULL, NULL, '2024-09-19 19:28:12+08', '2024-09-19 19:28:14+08');
INSERT INTO "public"."tbl_omc_alert_group" ("id", "name", "description", "status", "bp_id", "user_id", "create_time", "update_time") VALUES ('16', '多云管理-NSK计算节点', '多云管理-NSK计算节点', 0, NULL, NULL, '2024-09-19 19:28:46+08', '2024-09-19 19:28:48+08');
INSERT INTO "public"."tbl_omc_alert_metric" ("id", "group_id", "metric_name", "label", "duration_time", "level", "message", "metric_key", "alert_condition_display_statement", "alert_condition_param", "data_condition_label", "data_filters", "prom_content", "status", "bp_id", "user_id", "create_time", "update_time") VALUES ('1501', '15', '多云资源池健康状态', NULL, 10, 3, '资源池{{$labels.cloudName}}网络健康探测失败', 'cmp', '当资源池健康状态不是在线时，满足告警条件。', NULL, NULL, NULL, 'cmp{type="cloudHealth"} != 0', 0, NULL, NULL, '2024-09-19 19:32:00.50633+08', '2024-09-19 19:32:00.50633+08');
INSERT INTO "public"."tbl_omc_alert_metric" ("id", "group_id", "metric_name", "label", "duration_time", "level", "message", "metric_key", "alert_condition_display_statement", "alert_condition_param", "data_condition_label", "data_filters", "prom_content", "status", "bp_id", "user_id", "create_time", "update_time") VALUES ('1601', '16', '多云NSK计算节点状态', NULL, 10, 3, '资源池{{$labels.cloudId}}计算节点{{$labels.nodeName}}离线', 'cmp', '当计算节点状态是已离线时，满足告警状态。', NULL, NULL, NULL, 'cmp{type="hypervisorNodeStatus"} == 42', 0, NULL, NULL, '2024-09-19 19:55:32.957881+08', '2024-09-19 19:55:32.957881+08');

-- 20240925
ALTER TABLE "public"."tbl_omc_alert_group"
    ADD COLUMN "scope" int4 DEFAULT 0;

COMMENT ON COLUMN "public"."tbl_omc_alert_group"."scope" IS 'scope(0:private;1:bp;2:public)';

UPDATE "public"."tbl_omc_alert_group" SET "scope" = 2 WHERE "id" in ('1','3','4','12','14');
ALTER TABLE "public"."tbl_omc_alert_group"
    ADD COLUMN "service_type" varchar(64) COLLATE "pg_catalog"."default",
    ADD COLUMN "resource_type" varchar(64) COLLATE "pg_catalog"."default";

UPDATE "public"."tbl_omc_alert_group" SET  "service_type" = 'cmp', "resource_type" = 'ns_hypervisor_node' WHERE "id" = '11';
UPDATE "public"."tbl_omc_alert_group" SET  "service_type" = 'cmp', "resource_type" = NULL WHERE "id" = '15';
UPDATE "public"."tbl_omc_alert_group" SET  "service_type" = 'cmp', "resource_type" = 'ns_hypervisor_node' WHERE "id" = '16';
UPDATE "public"."tbl_omc_alert_group" SET  "service_type" = 'ecrm', "resource_type" = 'edge' WHERE "id" = '1';
UPDATE "public"."tbl_omc_alert_group" SET  "service_type" = 'ecrm', "resource_type" = 'edge' WHERE "id" = '3';
UPDATE "public"."tbl_omc_alert_group" SET  "service_type" = 'cis', "resource_type" = 'container' WHERE "id" = '4';
UPDATE "public"."tbl_omc_alert_group" SET  "service_type" = 'cmp', "resource_type" = 'ns_vm_instance' WHERE "id" = '12';
UPDATE "public"."tbl_omc_alert_group" SET  "service_type" = 'cmp', "resource_type" = 'ns_hypervisor_node' WHERE "id" = '13';
UPDATE "public"."tbl_omc_alert_group" SET  "service_type" = 'cmp', "resource_type" = 'ns_vm_instance' WHERE "id" = '14';


ALTER TABLE "public"."tbl_omc_alert_log"
    ADD COLUMN "unique_hash" int4;

ALTER TABLE "public"."tbl_omc_alert_log"
    ADD COLUMN "first_alert_time" timestamptz(6) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    ADD COLUMN "last_alert_time" timestamptz(6) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    ADD COLUMN "times" int4,
    ADD COLUMN "trigger_times" int4;

COMMENT ON COLUMN "public"."tbl_omc_alert_log"."first_alert_time" IS 'first alert time';

COMMENT ON COLUMN "public"."tbl_omc_alert_log"."last_alert_time" IS 'last alert time';

-- 20241015
UPDATE "public"."tbl_omc_alert_metric" SET "group_id" = '3', "metric_name" = '节点CPU使用率', "label" = NULL, "duration_time" = 10, "level" = 3, "message" = '站点: {{$labels.site_id}，节点: {{$labels.node_id}} CPU使用率大于 85 %，当前值 {{ printf "%.2f" $value }}%', "metric_key" = 'node_cpu_seconds_total', "alert_condition_display_statement" = '当节点CPU使用率 >= 85 %时，满足告警条件。', "alert_condition_param" = NULL, "data_condition_label" = NULL, "data_filters" = NULL, "prom_content" = '100 - avg by(instance, instance_id, instance_name, site_id) (rate(node_cpu_seconds_total{mode=\"idle\"}[2m])) * 100 >= 85', "status" = 0, "bp_id" = NULL, "user_id" = NULL, "create_time" = '2023-11-20 11:43:26.264268+08', "update_time" = '2023-11-20 11:43:26.264268+08' WHERE "id" = '200';
UPDATE "public"."tbl_omc_alert_metric" SET "group_id" = '3', "metric_name" = '节点Memory使用率', "label" = NULL, "duration_time" = 10, "level" = 3, "message" = '站点: {{$labels.site_id}}，节点: {{$labels.node_id}} Memory 使用率大于 85 %，当前值 {{ printf "%.2f" $value }}%', "metric_key" = 'node_memory_MemAvailable_bytes', "alert_condition_display_statement" = '当节点Memory使用率 >= 85 %时，满足告警条件。', "alert_condition_param" = NULL, "data_condition_label" = NULL, "data_filters" = NULL, "prom_content" = '100 - node_memory_MemAvailable_bytes{} / node_memory_MemTotal_bytes{} * 100 >= 85', "status" = 0, "bp_id" = NULL, "user_id" = NULL, "create_time" = '2023-11-20 11:50:56.746455+08', "update_time" = '2023-11-20 11:50:56.746455+08' WHERE "id" = '202';
UPDATE "public"."tbl_omc_alert_metric" SET "group_id" = '3', "metric_name" = '节点Disk使用率', "label" = NULL, "duration_time" = 10, "level" = 3, "message" = '站点: {{$labels.site_id}}，节点: {{$labels.node_id}} Disk 使用率大于 85 %，当前值 {{ printf "%.2f" $value }}%', "metric_key" = 'node_filesystem_avail_bytes', "alert_condition_display_statement" = '当节点Disk使用率 >= 85 %时，满足告警条件。', "alert_condition_param" = NULL, "data_condition_label" = NULL, "data_filters" = NULL, "prom_content" = '100 - (sum(node_filesystem_avail_bytes) by (instance_id,  siteid, device) * 100) / sum(node_filesystem_size_bytes) by (  instance_id, site_id, device) >= 85', "status" = 0, "bp_id" = NULL, "user_id" = NULL, "create_time" = '2023-11-20 11:50:14.286794+08', "update_time" = '2023-11-20 11:50:14.286794+08' WHERE "id" = '201';
UPDATE "public"."tbl_omc_alert_metric" SET "group_id" = '1', "metric_name" = '节点状态异常', "label" = NULL, "duration_time" = 10, "level" = 3, "message" = '节点{{$labels.node_id}}处于不可用状态超过10分钟', "metric_key" = 'up', "alert_condition_display_statement" = '当 ${metrics_name} 时，满足告警条件。', "alert_condition_param" = '[{"labelName":"metrics_name","showType":"text","detail":{"value":"节点状态异常"}}]', "data_condition_label" = '[{"label":"node_id","labelName":"节点","minWidth":160,"maxWidth":200,"children":null}]', "data_filters" = '[{"filterLabel":"node_id","filterDim":"node_id","filterDimName":"节点","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]}]', "prom_content" = 'up{${node_id}} ==  0', "status" = 0, "bp_id" = NULL, "user_id" = NULL, "create_time" = '2023-11-01 16:07:32.623255+08', "update_time" = '2023-11-01 16:07:32.623255+08' WHERE "id" = '3';
UPDATE "public"."tbl_omc_alert_metric" SET "group_id" = '14', "metric_name" = '虚拟机GPU温度', "label" = NULL, "duration_time" = 10, "level" = 3, "message" = 'nextstack云: {{$labels.cloud_id}}，虚拟机: {{$labels.instanceId}} GPU温度{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}，当前GPU温度 {{ printf "%.2f" $value }}', "metric_key" = NULL, "alert_condition_display_statement" = '当 ${metrics_name} ${opt} ${value} 时，满足告警条件。', "alert_condition_param" = '[{"labelName":"metrics_name","showType":"text","detail":{"value":"GPU温度"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":90,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', "data_condition_label" = '[{"label":"cloud_id","labelName":"云id","minWidth":160,"maxWidth":200,"children":{"label":"instanceId","labelName":"虚拟机id","minWidth":160,"maxWidth":200}}]', "data_filters" = '[{"filterLabel":"cloud_id","filterDim":"cloud_id","filterDimServiceType":"cmp","filterDimResourceType":"cloud","filterDimField":"cloud_id","filterDimDisplayField":"name","filterDimName":"云id","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"instanceId","filterDim":"instanceId", "filterDimServiceType":"cmp","filterDimResourceType":"ns_vm_instance","filterDimField":"instanceId","filterDimDisplayField":"name","filterDimName":"虚拟机id","valueType":"string","opt":"ALL","supportOpts":[{"label":"等于","value":"="},{"label":"不等于","value":"!="},{"label":"正则匹配","value":"=~"},{"label":"正则不匹配","value":"!~"},{"label":"遍历","value":"ALL"}],"value":"","showFilter":true,"values":[],"staticValue":false}]', "prom_content" = 'nvidia_smi_temperature_gpu{${cloud_id},${instanceId}}  ${opt} ${value}', "status" = 0, "bp_id" = NULL, "user_id" = NULL, "create_time" = '2024-03-26 19:35:10.684073+08', "update_time" = '2024-03-26 19:35:10.684073+08' WHERE "id" = '1403';
UPDATE "public"."tbl_omc_alert_metric" SET "group_id" = '13', "metric_name" = '计算节点GPU显存使用率', "label" = NULL, "duration_time" = 10, "level" = 3, "message" = 'nextstack云: {{$labels.cloud_id}}，计算节点: {{$labels.instance}} GPU显存使用率{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%，当前GPU显存使用率 {{ printf "%.2f" $value }}%', "metric_key" = NULL, "alert_condition_display_statement" = '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', "alert_condition_param" = '[{"labelName":"metrics_name","showType":"text","detail":{"value":"GPU显存使用率"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":90,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', "data_condition_label" = '[{"label":"cloud_id","labelName":"云id","minWidth":160,"maxWidth":200,"children":{"label":"nodeId","labelName":"计算节点id","minWidth":160,"maxWidth":200}}]', "data_filters" = '[{"filterLabel":"cloud_id","filterDim":"cloud_id","filterDimServiceType":"cmp","filterDimResourceType":"cloud","filterDimField":"cloud_id","filterDimDisplayField":"name","filterDimName":"云id","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"nodeId","filterDim":"nodeId", "filterDimServiceType":"cmp","filterDimResourceType":"ns_hypervisor_node","filterDimField":"nodeId","filterDimDisplayField":"name","filterDimPrefixField":"",filterDimSuffixField:"","filterDimName":"计算节点id","valueType":"string","opt":"ALL","supportOpts":[{"label":"等于","value":"="},{"label":"不等于","value":"!="},{"label":"正则匹配","value":"=~"},{"label":"正则不匹配","value":"!~"},{"label":"遍历","value":"ALL"}],"value":"","showFilter":true,"values":[],"staticValue":false}]', "prom_content" = 'nvidia_smi_utilization_memory_ratio{${cloud_id},${nodeId}}  * 100  ${opt} ${value}', "status" = 0, "bp_id" = NULL, "user_id" = NULL, "create_time" = '2024-03-26 19:34:46.185629+08', "update_time" = '2024-03-26 19:34:46.185629+08' WHERE "id" = '1302';
UPDATE "public"."tbl_omc_alert_metric" SET "group_id" = '13', "metric_name" = '计算节点GPU使用率', "label" = NULL, "duration_time" = 10, "level" = 3, "message" = 'nextstack云: {{$labels.cloud_id}}，计算节点: {{$labels.instance}} GPU使用率{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%，当前GPU使用率 {{ printf "%.2f" $value }}%', "metric_key" = NULL, "alert_condition_display_statement" = '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', "alert_condition_param" = '[{"labelName":"metrics_name","showType":"text","detail":{"value":"GPU使用率"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":90,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', "data_condition_label" = '[{"label":"cloud_id","labelName":"云id","minWidth":160,"maxWidth":200,"children":{"label":"nodeId","labelName":"计算节点id","minWidth":160,"maxWidth":200}}]', "data_filters" = '[{"filterLabel":"cloud_id","filterDim":"cloud_id","filterDimServiceType":"cmp","filterDimResourceType":"cloud","filterDimField":"cloud_id","filterDimDisplayField":"name","filterDimName":"云id","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"nodeId","filterDim":"nodeId", "filterDimServiceType":"cmp","filterDimResourceType":"ns_hypervisor_node","filterDimField":"nodeId","filterDimDisplayField":"name","filterDimPrefixField":"",filterDimSuffixField:"","filterDimName":"计算节点id","valueType":"string","opt":"ALL","supportOpts":[{"label":"等于","value":"="},{"label":"不等于","value":"!="},{"label":"正则匹配","value":"=~"},{"label":"正则不匹配","value":"!~"},{"label":"遍历","value":"ALL"}],"value":"","showFilter":true,"values":[],"staticValue":false}]', "prom_content" = 'nvidia_smi_utilization_gpu_ratio{${cloud_id},${nodeId}} * 100 ${opt} ${value}', "status" = 0, "bp_id" = NULL, "user_id" = NULL, "create_time" = '2024-03-26 19:34:40.380523+08', "update_time" = '2024-03-26 19:34:40.380523+08' WHERE "id" = '1301';
UPDATE "public"."tbl_omc_alert_metric" SET "group_id" = '11', "metric_name" = '计算节点实例在线状态', "label" = NULL, "duration_time" = 10, "level" = 3, "message" = '计算节点{{$labels.instance}}处于不可用状态', "metric_key" = NULL, "alert_condition_display_statement" = '当 ${metrics_name} 时，满足告警条件。', "alert_condition_param" = '[{"labelName":"metrics_name","showType":"text","detail":{"value":"实例离线"}}]', "data_condition_label" = '[{"label":"instance","labelName":"计算节点","minWidth":160,"maxWidth":200,"children":null}]', "data_filters" = '[{"filterLabel":"instance","filterDim":"instance", "filterDimServiceType":"cmp","filterDimResourceType":"ns_hypervisor_node","filterDimField":"manageIp","filterDimDisplayField":"name","filterDimPrefixField":"",filterDimSuffixField:":9100","filterDimName":"计算节点","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}] ,"placeholder":"ip:port,port为9100"}]', "prom_content" = 'up{type="libvirt_node", ${instance}}==0', "status" = 0, "bp_id" = NULL, "user_id" = NULL, "create_time" = '2024-03-23 15:50:00.393941+08', "update_time" = '2024-03-23 15:50:00.393941+08' WHERE "id" = '1107';
UPDATE "public"."tbl_omc_alert_metric" SET "group_id" = '1', "metric_name" = '节点内存使用率', "label" = NULL, "duration_time" = 10, "level" = 3, "message" = '节点 {{ $labels.node_id }} 内存使用率{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%，当前内存使用率 {{  printf "%.2f" $value }}%', "metric_key" = 'node_memory_usage', "alert_condition_display_statement" = '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', "alert_condition_param" = '[{"labelName":"metrics_name","showType":"text","detail":{"value":"节点内存使用率"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":90,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', "data_condition_label" = '[{"label":"node_id","labelName":"节点","minWidth":160,"maxWidth":200,"children":null}]', "data_filters" = '[{"filterLabel":"node_id","filterDim":"node_id","filterDimName":"节点","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]}]', "prom_content" = '100 - node_memory_MemAvailable_bytes{${node_id}} / node_memory_MemTotal_bytes{${node_id}} * 100 ${opt} ${value}', "status" = 0, "bp_id" = NULL, "user_id" = NULL, "create_time" = '2023-11-01 15:57:15.934687+08', "update_time" = '2023-11-01 15:57:15.934687+08' WHERE "id" = '2';
UPDATE "public"."tbl_omc_alert_metric" SET "group_id" = '1', "metric_name" = '节点cpu使用率', "label" = NULL, "duration_time" = 10, "level" = 2, "message" = '节点 {{$labels.node_id }} CPU使用率{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%，当前CPU使用率 {{ printf "%.2f" $value }}%', "metric_key" = 'node_cpu_usage', "alert_condition_display_statement" = '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', "alert_condition_param" = '[{"labelName":"metrics_name","showType":"text","detail":{"value":"节点CPU使用率"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":90,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', "data_condition_label" = '[{"label":"node_id","labelName":"节点","minWidth":160,"maxWidth":200,"children":null}]', "data_filters" = '[{"filterLabel":"node_id","filterDim":"node_id","filterDimName":"节点","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]}]', "prom_content" = '100 - avg by(node_id) (rate(node_cpu_seconds_total{mode="idle", ${node_id}}[2m])) * 100 ${opt} ${value}', "status" = 0, "bp_id" = NULL, "user_id" = NULL, "create_time" = '2023-11-01 15:45:59.114137+08', "update_time" = '2023-11-01 15:45:59.114137+08' WHERE "id" = '1';
UPDATE "public"."tbl_omc_alert_metric" SET "group_id" = '1', "metric_name" = '节点磁盘使用率', "label" = NULL, "duration_time" = 10, "level" = 2, "message" = '节点 {{ $labels.node_id }} 磁盘 {{ $labels.device }} 使用率{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%，当前磁盘使用率 {{ printf "%.2f" $value }}%', "metric_key" = 'node_disk_usage', "alert_condition_display_statement" = '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', "alert_condition_param" = '[{"labelName":"metrics_name","showType":"text","detail":{"value":"节点磁盘使用率"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":90,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', "data_condition_label" = '[{"label":"node_id","labelName":"节点","minWidth":160,"maxWidth":200,"children":{"label":"device","labelName":"磁盘","minWidth":160,"maxWidth":200,"children":null}}]', "data_filters" = '[{"filterLabel":"node_id","filterDim":"node_id","filterDimName":"节点","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"device","filterDim":"device","filterDimName":"磁盘","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]}]', "prom_content" = '100 - (sum(node_filesystem_avail_bytes{${node_id}, ${device}}) by (node_id, device) * 100) / sum(node_filesystem_size_bytes{${node_id}, ${device}}) by (node_id, device)  ${opt} ${value}', "status" = 0, "bp_id" = NULL, "user_id" = NULL, "create_time" = '2023-11-01 16:16:54.852724+08', "update_time" = '2023-11-01 16:16:54.852724+08' WHERE "id" = '4';
UPDATE "public"."tbl_omc_alert_metric" SET "group_id" = '4', "metric_name" = '容器内存使用率', "label" = NULL, "duration_time" = 10, "level" = 3, "message" = '节点: {{$labels.node_id}}  / 容器: {{$labels.name}}  (容器id:{{$labels.container_ref_id}}) 内存使用率 {{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%, 当前值{{ printf "%.2f" $value }}%', "metric_key" = 'container_memory_usage', "alert_condition_display_statement" = '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', "alert_condition_param" = '[{"labelName":"metrics_name","showType":"text","detail":{"value":"容器内存使用率"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":80,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', "data_condition_label" = '[{"label":"node_id","labelName":"节点id","minWidth":160,"maxWidth":200,"children":{"label":"name","labelName":"容器名","minWidth":160,"maxWidth":200}}]', "data_filters" = '[{"filterLabel":"node_id","filterDim":"node_id", "filterDimServiceType":"ecrm","filterDimResourceType":"edge","filterDimField":"node_id","filterDimDisplayField":"node_name","filterDimName":"节点id","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"name","filterDim":"name","filterDimServiceType":"cis","filterDimResourceType":"container","filterDimField":"name","filterDimDisplayField":"name","filterDimName":"容器名","valueType":"string","opt":"ALL","supportOpts":[{"label":"等于","value":"="},{"label":"不等于","value":"!="},{"label":"正则匹配","value":"=~"},{"label":"正则不匹配","value":"!~"},{"label":"遍历","value":"ALL"}],"value":"","showFilter":true,"values":[],"staticValue":false}]', "prom_content" = '(sum(container_memory_working_set_bytes {name=~".+",image!="",id!="",${node_id}, ${name}} ) BY (node_id, name,container_ref_id) / sum(container_spec_memory_limit_bytes {name=~".+",image!="",id!="",${node_id}, ${name}} > 0) BY (node_id, name,container_ref_id) * 100)  ${opt} ${value}', "status" = 0, "bp_id" = NULL, "user_id" = NULL, "create_time" = '2023-11-17 16:05:00.88865+08', "update_time" = '2023-11-17 16:05:00.88865+08' WHERE "id" = '301';
UPDATE "public"."tbl_omc_alert_metric" SET "group_id" = '4', "metric_name" = '容器磁盘使用率', "label" = NULL, "duration_time" = 10, "level" = 3, "message" = '节点: {{$labels.node_id}}  / 容器: {{$labels.name}}  (容器id:{{$labels.container_ref_id}}) 磁盘使用率 {{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%, 当前值{{ printf "%.2f" $value }}%', "metric_key" = 'container_fs_inodes_free', "alert_condition_display_statement" = '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', "alert_condition_param" = '[{"labelName":"metrics_name","showType":"text","detail":{"value":"容器磁盘使用率"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":80,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', "data_condition_label" = '[{"label":"node_id","labelName":"节点id","minWidth":160,"maxWidth":200,"children":{"label":"name","labelName":"容器名","minWidth":160,"maxWidth":200}}]', "data_filters" = '[{"filterLabel":"node_id","filterDim":"node_id", "filterDimServiceType":"ecrm","filterDimResourceType":"edge","filterDimField":"node_id","filterDimDisplayField":"node_name","filterDimName":"节点id","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"name","filterDim":"name","filterDimServiceType":"cis","filterDimResourceType":"container","filterDimField":"name","filterDimDisplayField":"name","filterDimName":"容器名","valueType":"string","opt":"ALL","supportOpts":[{"label":"等于","value":"="},{"label":"不等于","value":"!="},{"label":"正则匹配","value":"=~"},{"label":"正则不匹配","value":"!~"},{"label":"遍历","value":"ALL"}],"value":"","showFilter":true,"values":[],"staticValue":false}]', "prom_content" = '(1 - (sum(container_fs_inodes_free{name=~".+",image!="",id!="",${node_id}, ${name}}) BY (node_id, name,container_ref_id) / sum(container_fs_inodes_total) BY (node_id, name,container_ref_id))) * 100 ${opt} ${value}', "status" = 0, "bp_id" = NULL, "user_id" = NULL, "create_time" = '2023-11-17 16:05:00.88865+08', "update_time" = '2023-11-17 16:05:00.88865+08' WHERE "id" = '302';
UPDATE "public"."tbl_omc_alert_metric" SET "group_id" = '4', "metric_name" = '容器离线', "label" = NULL, "duration_time" = 10, "level" = 3, "message" = '节点: {{$labels.node_id}}  / 容器: {{$labels.name}}  (容器id:{{$labels.container_ref_id}}) 容器已被删除或停止', "metric_key" = 'container_last_seen', "alert_condition_display_statement" = '当 ${metrics_name} ${opt} ${value}秒 时，满足告警条件。', "alert_condition_param" = '[{"labelName":"metrics_name","showType":"text","detail":{"value":"离线时间"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":80,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', "data_condition_label" = '[{"label":"node_id","labelName":"节点id","minWidth":160,"maxWidth":200,"children":{"label":"name","labelName":"容器名","minWidth":160,"maxWidth":200}}]', "data_filters" = '[{"filterLabel":"node_id","filterDim":"node_id", "filterDimServiceType":"ecrm","filterDimResourceType":"edge","filterDimField":"node_id","filterDimDisplayField":"node_name","filterDimName":"节点id","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"name","filterDim":"name","filterDimServiceType":"cis","filterDimResourceType":"container","filterDimField":"name","filterDimDisplayField":"name","filterDimName":"容器名","valueType":"string","opt":"ALL","supportOpts":[{"label":"等于","value":"="},{"label":"不等于","value":"!="},{"label":"正则匹配","value":"=~"},{"label":"正则不匹配","value":"!~"},{"label":"遍历","value":"ALL"}],"value":"","showFilter":true,"values":[],"staticValue":false}]', "prom_content" = 'time() - container_last_seen{name=~".+",image!="",id!="",${node_id}, ${name}} ${opt} ${value}', "status" = 0, "bp_id" = NULL, "user_id" = NULL, "create_time" = '2023-11-17 16:05:00.88865+08', "update_time" = '2023-11-17 16:05:00.88865+08' WHERE "id" = '303';
UPDATE "public"."tbl_omc_alert_metric" SET "group_id" = '4', "metric_name" = '容器cpu使用率', "label" = NULL, "duration_time" = 10, "level" = 3, "message" = '节点: {{$labels.node_id}}  / 容器: {{$labels.name}}  (容器id:{{$labels.container_ref_id}}) CPU使用率{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%, 当前值{{ printf "%.2f" $value }}%', "metric_key" = 'container_cpu_usage', "alert_condition_display_statement" = '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', "alert_condition_param" = '[{"labelName":"metrics_name","showType":"text","detail":{"value":"容器CPU使用率"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":80,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', "data_condition_label" = '[{"label":"node_id","labelName":"节点","minWidth":160,"maxWidth":200,"children":{"label":"name","labelName":"容器","minWidth":160,"maxWidth":200}}]', "data_filters" = '[{"filterLabel":"node_id","filterDim":"node_id", "filterDimServiceType":"ecrm","filterDimResourceType":"edge","filterDimField":"node_id","filterDimDisplayField":"node_name","filterDimName":"节点id","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"name","filterDim":"name","filterDimServiceType":"cis","filterDimResourceType":"container","filterDimField":"name","filterDimDisplayField":"name","filterDimName":"容器名","valueType":"string","opt":"ALL","supportOpts":[{"label":"等于","value":"="},{"label":"不等于","value":"!="},{"label":"正则匹配","value":"=~"},{"label":"正则不匹配","value":"!~"},{"label":"遍历","value":"ALL"}],"value":"","showFilter":true,"values":[],"staticValue":false}]', "prom_content" = '(sum(rate(container_cpu_usage_seconds_total{name=~".+",image!="",id!="",${node_id}, ${name}}[3m])) BY (node_id, name,container_ref_id) * 100) ${opt} ${value}', "status" = 0, "bp_id" = NULL, "user_id" = NULL, "create_time" = '2023-11-17 16:04:25.697165+08', "update_time" = '2023-11-17 16:04:25.697165+08' WHERE "id" = '300';
UPDATE "public"."tbl_omc_alert_metric" SET "group_id" = '11', "metric_name" = '计算节点磁盘吞吐率', "label" = NULL, "duration_time" = 10, "level" = 3, "message" = 'nextstack云: {{$labels.cloud_id}}，计算节点: {{$labels.instance}} 磁盘吞吐率{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%，当前磁盘吞吐率 {{ printf "%.2f" $value }}%', "metric_key" = NULL, "alert_condition_display_statement" = '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', "alert_condition_param" = '[{"labelName":"metrics_name","showType":"text","detail":{"value":"计算节点磁盘吞吐率"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":90,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', "data_condition_label" = '[{"label":"cloud_id","labelName":"云id","minWidth":160,"maxWidth":200,"children":{"label":"instance","labelName":"计算节点","minWidth":160,"maxWidth":200}}]', "data_filters" = '[{"filterLabel":"cloud_id","filterDim":"cloud_id","filterDimServiceType":"cmp","filterDimResourceType":"cloud","filterDimField":"cloud_id","filterDimDisplayField":"name","filterDimName":"云id","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"instance","filterDim":"instance", "filterDimServiceType":"cmp","filterDimResourceType":"ns_hypervisor_node","filterDimField":"manageIp","filterDimDisplayField":"name","filterDimPrefixField":"",filterDimSuffixField:":9100","filterDimName":"计算节点","valueType":"string","opt":"ALL","supportOpts":[{"label":"等于","value":"="},{"label":"不等于","value":"!="},{"label":"正则匹配","value":"=~"},{"label":"正则不匹配","value":"!~"},{"label":"遍历","value":"ALL"}],"value":"","showFilter":true,"values":[],"staticValue":false,"placeholder":"ip:port,port为9100"}]', "prom_content" = 'round((irate(node_disk_read_bytes_total{device !~ ''dm.*|nbd.*'',  ${cloud_id}  ${instance}}[5m])+irate(node_disk_written_bytes_total{device !~ ''dm.*|nbd.*'',  ${cloud_id}  ${instance}}[5m]))/1024/1024 ${opt} ${value}  , 0.01) ', "status" = 0, "bp_id" = NULL, "user_id" = NULL, "create_time" = '2024-03-23 15:49:46.791444+08', "update_time" = '2024-03-23 15:49:46.791444+08' WHERE "id" = '1106';
UPDATE "public"."tbl_omc_alert_metric" SET "group_id" = '11', "metric_name" = '计算节点磁盘IOPS', "label" = NULL, "duration_time" = 10, "level" = 3, "message" = 'nextstack云: {{$labels.cloud_id}}，计算节点: {{$labels.instance}} 磁盘IOPS{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%，当前磁盘IOPS {{ printf "%.2f" $value }}%', "metric_key" = NULL, "alert_condition_display_statement" = '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', "alert_condition_param" = '[{"labelName":"metrics_name","showType":"text","detail":{"value":"计算节点磁盘IOPS"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":90,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', "data_condition_label" = '[{"label":"cloud_id","labelName":"云id","minWidth":160,"maxWidth":200,"children":{"label":"instance","labelName":"计算节点","minWidth":160,"maxWidth":200}}]', "data_filters" = '[{"filterLabel":"cloud_id","filterDim":"cloud_id","filterDimServiceType":"cmp","filterDimResourceType":"cloud","filterDimField":"cloud_id","filterDimDisplayField":"name","filterDimName":"云id","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"instance","filterDim":"instance", "filterDimServiceType":"cmp","filterDimResourceType":"ns_hypervisor_node","filterDimField":"manageIp","filterDimDisplayField":"name","filterDimPrefixField":"",filterDimSuffixField:":9100","filterDimName":"计算节点","valueType":"string","opt":"ALL","supportOpts":[{"label":"等于","value":"="},{"label":"不等于","value":"!="},{"label":"正则匹配","value":"=~"},{"label":"正则不匹配","value":"!~"},{"label":"遍历","value":"ALL"}],"value":"","showFilter":true,"values":[],"staticValue":false,"placeholder":"ip:port,port为9100"}]', "prom_content" = 'round(irate(node_disk_reads_completed_total{ device !~ ''dm.*|nbd.*'',  ${cloud_id}  ${instance}}[5m])+irate(node_disk_writes_completed_total{device !~ ''dm.*|nbd.*'',  ${cloud_id}  ${instance}}[5m]) ${opt} ${value}    , 0.01)', "status" = 0, "bp_id" = NULL, "user_id" = NULL, "create_time" = '2024-03-23 15:49:41.702004+08', "update_time" = '2024-03-23 15:49:41.702004+08' WHERE "id" = '1105';
UPDATE "public"."tbl_omc_alert_metric" SET "group_id" = '11', "metric_name" = '计算节点网络吞吐率', "label" = NULL, "duration_time" = 10, "level" = 3, "message" = 'nextstack云: {{$labels.cloud_id}}，计算节点: {{$labels.instance}} 网络吞吐率{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%，当前网络吞吐率 {{ printf "%.2f" $value }}%', "metric_key" = NULL, "alert_condition_display_statement" = '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', "alert_condition_param" = '[{"labelName":"metrics_name","showType":"text","detail":{"value":"计算节点网络吞吐率"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":90,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', "data_condition_label" = '[{"label":"cloud_id","labelName":"云id","minWidth":160,"maxWidth":200,"children":{"label":"instance","labelName":"计算节点","minWidth":160,"maxWidth":200}}]', "data_filters" = '[{"filterLabel":"cloud_id","filterDim":"cloud_id","filterDimServiceType":"cmp","filterDimResourceType":"cloud","filterDimField":"cloud_id","filterDimDisplayField":"name","filterDimName":"云id","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"instance","filterDim":"instance", "filterDimServiceType":"cmp","filterDimResourceType":"ns_hypervisor_node","filterDimField":"manageIp","filterDimDisplayField":"name","filterDimPrefixField":"",filterDimSuffixField:":9100","filterDimName":"计算节点","valueType":"string","opt":"ALL","supportOpts":[{"label":"等于","value":"="},{"label":"不等于","value":"!="},{"label":"正则匹配","value":"=~"},{"label":"正则不匹配","value":"!~"},{"label":"遍历","value":"ALL"}],"value":"","showFilter":true,"values":[],"staticValue":false,"placeholder":"ip:port,port为9100"}]', "prom_content" = 'round((irate(node_network_receive_bytes_total{ device !~ ''br.*|v.*|ovs.*|lo*|docker.*|.*o'',  ${cloud_id}  ${instance}}[5m]) or irate(node_network_transmit_bytes_total{device !~ ''br.*|v.*|ovs.*|lo*|docker.*|.*o'',  ${cloud_id}  ${instance}}[5m]))/1024/1024 ${opt} ${value}   , 0.01)', "status" = 0, "bp_id" = NULL, "user_id" = NULL, "create_time" = '2024-03-23 15:49:36.134082+08', "update_time" = '2024-03-23 15:49:36.134082+08' WHERE "id" = '1104';
UPDATE "public"."tbl_omc_alert_metric" SET "group_id" = '11', "metric_name" = '计算节点文件系统使用率', "label" = NULL, "duration_time" = 10, "level" = 3, "message" = 'nextstack云: {{$labels.cloud_id}}，计算节点: {{$labels.instance}} 计算节点文件系统使用率{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%，当前计算节点文件系统使用率 {{ printf "%.2f" $value }}%', "metric_key" = NULL, "alert_condition_display_statement" = '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', "alert_condition_param" = '[{"labelName":"metrics_name","showType":"text","detail":{"value":"计算节点文件系统使用率"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":90,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', "data_condition_label" = '[{"label":"cloud_id","labelName":"云id","minWidth":160,"maxWidth":200,"children":{"label":"instance","labelName":"计算节点","minWidth":160,"maxWidth":200}}]', "data_filters" = '[{"filterLabel":"cloud_id","filterDim":"cloud_id","filterDimServiceType":"cmp","filterDimResourceType":"cloud","filterDimField":"cloud_id","filterDimDisplayField":"name","filterDimName":"云id","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"instance","filterDim":"instance", "filterDimServiceType":"cmp","filterDimResourceType":"ns_hypervisor_node","filterDimField":"manageIp","filterDimDisplayField":"name","filterDimPrefixField":"",filterDimSuffixField:":9100","filterDimName":"计算节点","valueType":"string","opt":"ALL","supportOpts":[{"label":"等于","value":"="},{"label":"不等于","value":"!="},{"label":"正则匹配","value":"=~"},{"label":"正则不匹配","value":"!~"},{"label":"遍历","value":"ALL"}],"value":"","showFilter":true,"values":[],"staticValue":false,"placeholder":"ip:port,port为9100"}]', "prom_content" = 'round(100.0 - 100 * (node_filesystem_avail_bytes{device !~''tmpfs'',device!~''by-uuid'', ${cloud_id} ${instance}} / node_filesystem_size_bytes{device !~''tmpfs'',device!~''by-uuid'', ${cloud_id}  ${instance}}) ${opt} ${value}    , 0.01)', "status" = 0, "bp_id" = NULL, "user_id" = NULL, "create_time" = '2024-03-23 15:49:25.793958+08', "update_time" = '2024-03-23 15:49:25.793958+08' WHERE "id" = '1103';
UPDATE "public"."tbl_omc_alert_metric" SET "group_id" = '11', "metric_name" = '计算节点CPU使用率', "label" = NULL, "duration_time" = 10, "level" = 3, "message" = 'nextstack云: {{$labels.cloud_id}}，计算节点: {{$labels.instance}} CPU使用率{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%，当前CPU使用率 {{ printf "%.2f" $value }}%', "metric_key" = NULL, "alert_condition_display_statement" = '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', "alert_condition_param" = '[{"labelName":"metrics_name","showType":"text","detail":{"value":"计算节点CPU使用率"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":90,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', "data_condition_label" = '[{"label":"cloud_id","labelName":"云id","minWidth":160,"maxWidth":200,"children":{"label":"instance","labelName":"计算节点","minWidth":160,"maxWidth":200}}]', "data_filters" = '[{"filterLabel":"cloud_id","filterDim":"cloud_id","filterDimServiceType":"cmp","filterDimResourceType":"cloud","filterDimField":"cloud_id","filterDimDisplayField":"name","filterDimName":"云id","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"instance","filterDim":"instance", "filterDimServiceType":"cmp","filterDimResourceType":"ns_hypervisor_node","filterDimField":"manageIp","filterDimDisplayField":"name","filterDimPrefixField":"",filterDimSuffixField:":9100","filterDimName":"计算节点","valueType":"string","opt":"ALL","supportOpts":[{"label":"等于","value":"="},{"label":"不等于","value":"!="},{"label":"正则匹配","value":"=~"},{"label":"正则不匹配","value":"!~"},{"label":"遍历","value":"ALL"}],"value":"","showFilter":true,"values":[],"staticValue":false,"placeholder":"ip:port,port为9100"}]', "prom_content" = 'round(100-(sum(increase(node_cpu_seconds_total{mode=''idle'',  ${cloud_id}  ${instance}}[5m]))by(instance)) /(sum(increase(node_cpu_seconds_total[5m]))by(instance))  ${opt} ${value}   ,0.01)', "status" = 0, "bp_id" = NULL, "user_id" = NULL, "create_time" = '2024-03-23 15:48:53.176851+08', "update_time" = '2024-03-23 15:48:53.176851+08' WHERE "id" = '1101';
UPDATE "public"."tbl_omc_alert_metric" SET "group_id" = '11', "metric_name" = '计算节点内存使用率', "label" = NULL, "duration_time" = 10, "level" = 3, "message" = 'nextstack云: {{$labels.cloud_id}}，计算节点: {{$labels.instance}} 内存使用率{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%，当前内存使用率 {{ printf "%.2f" $value }}%', "metric_key" = NULL, "alert_condition_display_statement" = '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', "alert_condition_param" = '[{"labelName":"metrics_name","showType":"text","detail":{"value":"节点内存使用率"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":90,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', "data_condition_label" = '[{"label":"cloud_id","labelName":"云id","minWidth":160,"maxWidth":200,"children":{"label":"instance","labelName":"计算节点","minWidth":160,"maxWidth":200}}]', "data_filters" = '[{"filterLabel":"cloud_id","filterDim":"cloud_id","filterDimServiceType":"cmp","filterDimResourceType":"cloud","filterDimField":"cloud_id","filterDimDisplayField":"name","filterDimName":"云id","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"instance","filterDim":"instance", "filterDimServiceType":"cmp","filterDimResourceType":"ns_hypervisor_node","filterDimField":"manageIp","filterDimDisplayField":"name","filterDimPrefixField":"",filterDimSuffixField:":9100","filterDimName":"计算节点id","valueType":"string","opt":"ALL","supportOpts":[{"label":"等于","value":"="},{"label":"不等于","value":"!="},{"label":"正则匹配","value":"=~"},{"label":"正则不匹配","value":"!~"},{"label":"遍历","value":"ALL"}],"value":"","showFilter":true,"values":[],"staticValue":false,"placeholder":"ip:port,port为9100"}]', "prom_content" = 'round((1-(node_memory_MemAvailable_bytes{${cloud_id}  ${instance}}/node_memory_MemTotal_bytes{${cloud_id}  ${instance}}))*100 ${opt} ${value}  , 0.01)', "status" = 0, "bp_id" = NULL, "user_id" = NULL, "create_time" = '2024-03-23 15:48:53.176851+08', "update_time" = '2024-03-23 15:48:53.176851+08' WHERE "id" = '1102';
UPDATE "public"."tbl_omc_alert_metric" SET "group_id" = '12', "metric_name" = '虚拟机在线状态', "label" = NULL, "duration_time" = 10, "level" = 3, "message" = '虚拟机{{$labels.instanceId}}处于不可用状态', "metric_key" = NULL, "alert_condition_display_statement" = '当 ${metrics_name} 时，满足告警条件。', "alert_condition_param" = '[{"labelName":"metrics_name","showType":"text","detail":{"value":"实例离线"}}]', "data_condition_label" = '[{"label":"instanceId","labelName":"虚拟机","minWidth":160,"maxWidth":200,"children":null}]', "data_filters" = ' [{"filterLabel":"cloud_id","filterDim":"cloud_id","filterDimServiceType":"cmp","filterDimResourceType":"cloud","filterDimField":"cloud_id","filterDimDisplayField":"name","filterDimName":"云id","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"instanceId","filterDim":"instanceId", "filterDimServiceType":"cmp","filterDimResourceType":"ns_vm_instance","filterDimField":"instanceId","filterDimDisplayField":"name","filterDimName":"虚拟机id","valueType":"string","opt":"ALL","supportOpts":[{"label":"等于","value":"="},{"label":"不等于","value":"!="},{"label":"正则匹配","value":"=~"},{"label":"正则不匹配","value":"!~"},{"label":"遍历","value":"ALL"}],"value":"","showFilter":true,"values":[],"staticValue":false}]', "prom_content" = 'libvirt_domain_state_code{ job="libvirt_server", \${cloud_id},\${instanceId}}==5 or libvirt_domain_state_code{ job="libvirt_server", \${cloud_id},\${instanceId}} ==6', "status" = 0, "bp_id" = NULL, "user_id" = NULL, "create_time" = '2024-03-25 14:25:58.449307+08', "update_time" = '2024-03-25 14:25:58.449307+08' WHERE "id" = '1207';
UPDATE "public"."tbl_omc_alert_metric" SET "group_id" = '12', "metric_name" = '虚拟机磁盘吞吐率', "label" = NULL, "duration_time" = 10, "level" = 3, "message" = 'nextstack云: {{$labels.cloud_id}}，虚拟机: {{$labels.instanceId}} 磁盘IOPS{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%，当前磁盘IOPS {{ printf "%.2f" $value }}%', "metric_key" = NULL, "alert_condition_display_statement" = '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', "alert_condition_param" = '[{"labelName":"metrics_name","showType":"text","detail":{"value":"虚拟机磁盘吞吐率"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":90,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', "data_condition_label" = '[{"label":"instanceId","labelName":"虚拟机","minWidth":160,"maxWidth":200,"children":null}]', "data_filters" = ' [{"filterLabel":"cloud_id","filterDim":"cloud_id","filterDimServiceType":"cmp","filterDimResourceType":"cloud","filterDimField":"cloud_id","filterDimDisplayField":"name","filterDimName":"云id","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"instanceId","filterDim":"instanceId", "filterDimServiceType":"cmp","filterDimResourceType":"ns_vm_instance","filterDimField":"instanceId","filterDimDisplayField":"name","filterDimName":"虚拟机id","valueType":"string","opt":"ALL","supportOpts":[{"label":"等于","value":"="},{"label":"不等于","value":"!="},{"label":"正则匹配","value":"=~"},{"label":"正则不匹配","value":"!~"},{"label":"遍历","value":"ALL"}],"value":"","showFilter":true,"values":[],"staticValue":false}]', "prom_content" = 'round((rate(libvirt_domain_block_stats_read_bytes_total{\${cloud_id},\${instanceId}}[10m])+rate(libvirt_domain_block_stats_write_bytes_total{\${cloud_id},\${instanceId}}[10m]))/1024/1024 ${opt} ${value}  , 0.01)', "status" = 0, "bp_id" = NULL, "user_id" = NULL, "create_time" = '2024-03-25 14:25:51.333642+08', "update_time" = '2024-03-25 14:25:51.333642+08' WHERE "id" = '1206';
UPDATE "public"."tbl_omc_alert_metric" SET "group_id" = '12', "metric_name" = '虚拟机磁盘IOPS', "label" = NULL, "duration_time" = 10, "level" = 3, "message" = 'nextstack云: {{$labels.cloud_id}，虚拟机: {{$labels.instanceId}} 磁盘IOPS{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%，当前磁盘IOPS {{ printf "%.2f" $value }}%', "metric_key" = NULL, "alert_condition_display_statement" = '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', "alert_condition_param" = '[{"labelName":"metrics_name","showType":"text","detail":{"value":"虚拟机磁盘IOPS"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":90,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', "data_condition_label" = '[{"label":"instanceId","labelName":"虚拟机","minWidth":160,"maxWidth":200,"children":null}]', "data_filters" = ' [{"filterLabel":"cloud_id","filterDim":"cloud_id","filterDimServiceType":"cmp","filterDimResourceType":"cloud","filterDimField":"cloud_id","filterDimDisplayField":"name","filterDimName":"云id","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"instanceId","filterDim":"instanceId", "filterDimServiceType":"cmp","filterDimResourceType":"ns_vm_instance","filterDimField":"instanceId","filterDimDisplayField":"name","filterDimName":"虚拟机id","valueType":"string","opt":"ALL","supportOpts":[{"label":"等于","value":"="},{"label":"不等于","value":"!="},{"label":"正则匹配","value":"=~"},{"label":"正则不匹配","value":"!~"},{"label":"遍历","value":"ALL"}],"value":"","showFilter":true,"values":[],"staticValue":false}]', "prom_content" = 'round(rate(libvirt_domain_block_stats_read_requests_total{\${cloud_id},\${instanceId}}[10m])+rate(libvirt_domain_block_stats_write_requests_total{\${cloud_id},\${instanceId}}[10m]) ${opt} ${value}  , 0.01)', "status" = 0, "bp_id" = NULL, "user_id" = NULL, "create_time" = '2024-03-25 14:25:44.169758+08', "update_time" = '2024-03-25 14:25:44.169758+08' WHERE "id" = '1205';
UPDATE "public"."tbl_omc_alert_metric" SET "group_id" = '12', "metric_name" = '虚拟机网络吞吐率', "label" = NULL, "duration_time" = 10, "level" = 3, "message" = 'nextstack云: {{$labels.cloud_id}}，虚拟机: {{$labels.instanceId}} 网络吞吐率{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%，当前网络吞吐率 {{ printf "%.2f" $value }}%', "metric_key" = NULL, "alert_condition_display_statement" = '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', "alert_condition_param" = '[{"labelName":"metrics_name","showType":"text","detail":{"value":"虚拟机网络吞吐率"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":90,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', "data_condition_label" = '[{"label":"instanceId","labelName":"虚拟机","minWidth":160,"maxWidth":200,"children":null}]', "data_filters" = ' [{"filterLabel":"cloud_id","filterDim":"cloud_id","filterDimServiceType":"cmp","filterDimResourceType":"cloud","filterDimField":"cloud_id","filterDimDisplayField":"name","filterDimName":"云id","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"instanceId","filterDim":"instanceId", "filterDimServiceType":"cmp","filterDimResourceType":"ns_vm_instance","filterDimField":"instanceId","filterDimDisplayField":"name","filterDimName":"虚拟机id","valueType":"string","opt":"ALL","supportOpts":[{"label":"等于","value":"="},{"label":"不等于","value":"!="},{"label":"正则匹配","value":"=~"},{"label":"正则不匹配","value":"!~"},{"label":"遍历","value":"ALL"}],"value":"","showFilter":true,"values":[],"staticValue":false}]', "prom_content" = 'round((rate(libvirt_domain_interface_stats_receive_bytes_total{\${cloud_id},\${instanceId}}[10m])+rate(libvirt_domain_interface_stats_transmit_bytes_total{\${cloud_id},\${instanceId}}[10m]))/1024/1024 ${opt} ${value}  , 0.01)', "status" = 0, "bp_id" = NULL, "user_id" = NULL, "create_time" = '2024-03-25 14:25:36.685417+08', "update_time" = '2024-03-25 14:25:36.685417+08' WHERE "id" = '1204';
UPDATE "public"."tbl_omc_alert_metric" SET "group_id" = '12', "metric_name" = '虚拟机文件系统使用率', "label" = NULL, "duration_time" = 10, "level" = 3, "message" = 'nextstack云: {{$labels.cloud_id}}，虚拟机: {{$labels.instance_id}} 文件系统使用率{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%，当前计算节点文件系统使用率 {{ printf "%.2f" $value }}%', "metric_key" = NULL, "alert_condition_display_statement" = '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', "alert_condition_param" = '[{"labelName":"metrics_name","showType":"text","detail":{"value":"虚拟机文件系统使用率"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":90,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', "data_condition_label" = '[{"label":"instanceId","labelName":"虚拟机","minWidth":160,"maxWidth":200,"children":null}]', "data_filters" = ' [{"filterLabel":"cloud_id","filterDim":"cloud_id","filterDimServiceType":"cmp","filterDimResourceType":"cloud","filterDimField":"cloud_id","filterDimDisplayField":"name","filterDimName":"云id","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"instanceId","filterDim":"instanceId", "filterDimServiceType":"cmp","filterDimResourceType":"ns_vm_instance","filterDimField":"instanceId","filterDimDisplayField":"name","filterDimName":"虚拟机id","valueType":"string","opt":"ALL","supportOpts":[{"label":"等于","value":"="},{"label":"不等于","value":"!="},{"label":"正则匹配","value":"=~"},{"label":"正则不匹配","value":"!~"},{"label":"遍历","value":"ALL"}],"value":"","showFilter":true,"values":[],"staticValue":false}]', "prom_content" = 'round(ceil(libvirt_domain_filesystem_stats_used_percent{\${cloud_id},\${instanceId}}*100) ${opt} ${value}    , 0.01)', "status" = 0, "bp_id" = NULL, "user_id" = NULL, "create_time" = '2024-03-25 14:25:29.32883+08', "update_time" = '2024-03-25 14:25:29.32883+08' WHERE "id" = '1203';
UPDATE "public"."tbl_omc_alert_metric" SET "group_id" = '12', "metric_name" = '虚拟机内存使用率', "label" = NULL, "duration_time" = 10, "level" = 3, "message" = 'nextstack云: {{$labels.cloud_id}}，虚拟机: {{$labels.instance_id}} 内存使用率{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%，当前内存使用率 {{ printf "%.2f" $value }}%', "metric_key" = NULL, "alert_condition_display_statement" = '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', "alert_condition_param" = '[{"labelName":"metrics_name","showType":"text","detail":{"value":"虚拟机内存使用率"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":90,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', "data_condition_label" = '[{"label":"instanceId","labelName":"虚拟机","minWidth":160,"maxWidth":200,"children":null}]', "data_filters" = ' [{"filterLabel":"cloud_id","filterDim":"cloud_id","filterDimServiceType":"cmp","filterDimResourceType":"cloud","filterDimField":"cloud_id","filterDimDisplayField":"name","filterDimName":"云id","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"instanceId","filterDim":"instanceId", "filterDimServiceType":"cmp","filterDimResourceType":"ns_vm_instance","filterDimField":"instanceId","filterDimDisplayField":"name","filterDimName":"虚拟机id","valueType":"string","opt":"ALL","supportOpts":[{"label":"等于","value":"="},{"label":"不等于","value":"!="},{"label":"正则匹配","value":"=~"},{"label":"正则不匹配","value":"!~"},{"label":"遍历","value":"ALL"}],"value":"","showFilter":true,"values":[],"staticValue":false}]', "prom_content" = 'round((1-libvirt_domain_stat_memory_usable_bytes{\${cloud_id},\${instanceId}}/libvirt_domain_stat_memory_available_bytes{\${cloud_id},\${instanceId}})*100 ${opt} ${value}  , 0.01)', "status" = 0, "bp_id" = NULL, "user_id" = NULL, "create_time" = '2024-03-25 14:25:21.413899+08', "update_time" = '2024-03-25 14:25:21.413899+08' WHERE "id" = '1202';
UPDATE "public"."tbl_omc_alert_metric" SET "group_id" = '12', "metric_name" = '虚拟机CPU使用率', "label" = NULL, "duration_time" = 10, "level" = 3, "message" = 'nextstack云: {{$labels.cloud_id}}，虚拟机: {{$labels.instanceId}} CPU使用率{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%，当前CPU使用率 {{ printf "%.2f" $value }}%', "metric_key" = NULL, "alert_condition_display_statement" = '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', "alert_condition_param" = '[{"labelName":"metrics_name","showType":"text","detail":{"value":"虚拟机CPU使用率"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":90,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', "data_condition_label" = '[{"label":"instanceId","labelName":"虚拟机","minWidth":160,"maxWidth":200,"children":null}]', "data_filters" = ' [{"filterLabel":"cloud_id","filterDim":"cloud_id","filterDimServiceType":"cmp","filterDimResourceType":"cloud","filterDimField":"cloud_id","filterDimDisplayField":"name","filterDimName":"云id","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"instanceId","filterDim":"instanceId", "filterDimServiceType":"cmp","filterDimResourceType":"ns_vm_instance","filterDimField":"instanceId","filterDimDisplayField":"name","filterDimName":"虚拟机id","valueType":"string","opt":"ALL","supportOpts":[{"label":"等于","value":"="},{"label":"不等于","value":"!="},{"label":"正则匹配","value":"=~"},{"label":"正则不匹配","value":"!~"},{"label":"遍历","value":"ALL"}],"value":"","showFilter":true,"values":[],"staticValue":false}]', "prom_content" = 'round(rate(libvirt_domain_info_cpu_time_seconds_total{\${cloud_id},\${instanceId}}[10m])/(libvirt_domain_info_virtual_cpus{\${cloud_id},\${instanceId}})*100 ${opt} ${value}  , 0.01)', "status" = 0, "bp_id" = NULL, "user_id" = NULL, "create_time" = '2024-03-25 14:25:12.896074+08', "update_time" = '2024-03-25 14:25:12.896074+08' WHERE "id" = '1201';
UPDATE "public"."tbl_omc_alert_metric" SET "group_id" = '13', "metric_name" = '计算节点GPU温度', "label" = NULL, "duration_time" = 10, "level" = 3, "message" = 'nextstack云: {{$labels.cloud_id}}，计算节点: {{$labels.instance}} GPU温度{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}，当前GPU温度 {{ printf "%.2f" $value }}', "metric_key" = NULL, "alert_condition_display_statement" = '当 ${metrics_name} ${opt} ${value} 时，满足告警条件。', "alert_condition_param" = '[{"labelName":"metrics_name","showType":"text","detail":{"value":"GPU温度"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":90,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', "data_condition_label" = '[{"label":"cloud_id","labelName":"云id","minWidth":160,"maxWidth":200,"children":{"label":"nodeId","labelName":"计算节点id","minWidth":160,"maxWidth":200}}]', "data_filters" = '[{"filterLabel":"cloud_id","filterDim":"cloud_id","filterDimServiceType":"cmp","filterDimResourceType":"cloud","filterDimField":"cloud_id","filterDimDisplayField":"name","filterDimName":"云id","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"nodeId","filterDim":"nodeId", "filterDimServiceType":"cmp","filterDimResourceType":"ns_hypervisor_node","filterDimField":"nodeId","filterDimDisplayField":"name","filterDimPrefixField":"",filterDimSuffixField:"","filterDimName":"计算节点id","valueType":"string","opt":"ALL","supportOpts":[{"label":"等于","value":"="},{"label":"不等于","value":"!="},{"label":"正则匹配","value":"=~"},{"label":"正则不匹配","value":"!~"},{"label":"遍历","value":"ALL"}],"value":"","showFilter":true,"values":[],"staticValue":false}]', "prom_content" = 'nvidia_smi_temperature_gpu{${cloud_id},${nodeId}}  ${opt} ${value}', "status" = 0, "bp_id" = NULL, "user_id" = NULL, "create_time" = '2024-03-26 19:34:50.955362+08', "update_time" = '2024-03-26 19:34:50.955362+08' WHERE "id" = '1303';
UPDATE "public"."tbl_omc_alert_metric" SET "group_id" = '14', "metric_name" = '虚拟机GPU显存使用率', "label" = NULL, "duration_time" = 10, "level" = 3, "message" = 'nextstack云: {{$labels.cloud_id}}，虚拟机: {{$labels.instanceId}} GPU显存使用率{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%，当前GPU显存使用率 {{ printf "%.2f" $value }}%', "metric_key" = NULL, "alert_condition_display_statement" = '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', "alert_condition_param" = '[{"labelName":"metrics_name","showType":"text","detail":{"value":"GPU显存使用率"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":90,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', "data_condition_label" = '[{"label":"cloud_id","labelName":"云id","minWidth":160,"maxWidth":200,"children":{"label":"instanceId","labelName":"虚拟机id","minWidth":160,"maxWidth":200}}]', "data_filters" = '[{"filterLabel":"cloud_id","filterDim":"cloud_id","filterDimServiceType":"cmp","filterDimResourceType":"cloud","filterDimField":"cloud_id","filterDimDisplayField":"name","filterDimName":"云id","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"instanceId","filterDim":"instanceId", "filterDimServiceType":"cmp","filterDimResourceType":"ns_vm_instance","filterDimField":"instanceId","filterDimDisplayField":"name","filterDimName":"虚拟机id","valueType":"string","opt":"ALL","supportOpts":[{"label":"等于","value":"="},{"label":"不等于","value":"!="},{"label":"正则匹配","value":"=~"},{"label":"正则不匹配","value":"!~"},{"label":"遍历","value":"ALL"}],"value":"","showFilter":true,"values":[],"staticValue":false}]', "prom_content" = 'nvidia_smi_utilization_memory_ratio{${cloud_id},${instanceId}}  * 100  ${opt} ${value}', "status" = 0, "bp_id" = NULL, "user_id" = NULL, "create_time" = '2024-03-26 19:35:00.013832+08', "update_time" = '2024-03-26 19:35:00.013832+08' WHERE "id" = '1402';
UPDATE "public"."tbl_omc_alert_metric" SET "group_id" = '14', "metric_name" = '虚拟机GPU使用率', "label" = NULL, "duration_time" = 10, "level" = 3, "message" = 'nextstack云: {{$labels.cloud_id}}，虚拟机: {{$labels.instanceId}} GPU使用率{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%，当前GPU使用率 {{ printf "%.2f" $value }}%', "metric_key" = NULL, "alert_condition_display_statement" = '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', "alert_condition_param" = '[{"labelName":"metrics_name","showType":"text","detail":{"value":"GPU使用率"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":90,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', "data_condition_label" = '[{"label":"cloud_id","labelName":"云id","minWidth":160,"maxWidth":200,"children":{"label":"instanceId","labelName":"虚拟机id","minWidth":160,"maxWidth":200}}]', "data_filters" = '[{"filterLabel":"cloud_id","filterDim":"cloud_id","filterDimServiceType":"cmp","filterDimResourceType":"cloud","filterDimField":"cloud_id","filterDimDisplayField":"name","filterDimName":"云id","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"instanceId","filterDim":"instanceId", "filterDimServiceType":"cmp","filterDimResourceType":"ns_vm_instance","filterDimField":"instanceId","filterDimDisplayField":"name","filterDimName":"虚拟机id","valueType":"string","opt":"ALL","supportOpts":[{"label":"等于","value":"="},{"label":"不等于","value":"!="},{"label":"正则匹配","value":"=~"},{"label":"正则不匹配","value":"!~"},{"label":"遍历","value":"ALL"}],"value":"","showFilter":true,"values":[],"staticValue":false}]', "prom_content" = 'nvidia_smi_utilization_gpu_ratio{${cloud_id},${instanceId}}  * 100  ${opt} ${value}', "status" = 0, "bp_id" = NULL, "user_id" = NULL, "create_time" = '2024-03-26 19:34:55.685682+08', "update_time" = '2024-03-26 19:34:55.685682+08' WHERE "id" = '1401';


-- 20250917
UPDATE "public"."tbl_omc_alert_metric" SET "group_id" = '3', "metric_name" = '节点CPU使用率', "label" = NULL, "duration_time" = 10, "level" = 3, "message" = '站点: {{$labels.site_id}，节点: {{$labels.node_id}} CPU使用率大于 85 %，当前值 {{ printf "%.2f" $value }}%', "metric_key" = 'node_cpu_seconds_total', "alert_condition_display_statement" = '当节点CPU使用率 >= 85 %时，满足告警条件。', "alert_condition_param" = NULL, "data_condition_label" = NULL, "data_filters" = NULL, "prom_content" = '100 - avg by(instance, instance_id, instance_name, site_id) (rate(node_cpu_seconds_total{mode=\"idle\"}[2m])) * 100 >= 85', "status" = 0, "bp_id" = NULL, "user_id" = NULL, "create_time" = '2023-11-20 11:43:26.264268+08', "update_time" = '2023-11-20 11:43:26.264268+08' WHERE "id" = '200';
UPDATE "public"."tbl_omc_alert_metric" SET "group_id" = '3', "metric_name" = '节点Memory使用率', "label" = NULL, "duration_time" = 10, "level" = 3, "message" = '站点: {{$labels.site_id}}，节点: {{$labels.node_id}} Memory 使用率大于 85 %，当前值 {{ printf "%.2f" $value }}%', "metric_key" = 'node_memory_MemAvailable_bytes', "alert_condition_display_statement" = '当节点Memory使用率 >= 85 %时，满足告警条件。', "alert_condition_param" = NULL, "data_condition_label" = NULL, "data_filters" = NULL, "prom_content" = '100 - node_memory_MemAvailable_bytes{} / node_memory_MemTotal_bytes{} * 100 >= 85', "status" = 0, "bp_id" = NULL, "user_id" = NULL, "create_time" = '2023-11-20 11:50:56.746455+08', "update_time" = '2023-11-20 11:50:56.746455+08' WHERE "id" = '202';
UPDATE "public"."tbl_omc_alert_metric" SET "group_id" = '3', "metric_name" = '节点Disk使用率', "label" = NULL, "duration_time" = 10, "level" = 3, "message" = '站点: {{$labels.site_id}}，节点: {{$labels.node_id}} Disk 使用率大于 85 %，当前值 {{ printf "%.2f" $value }}%', "metric_key" = 'node_filesystem_avail_bytes', "alert_condition_display_statement" = '当节点Disk使用率 >= 85 %时，满足告警条件。', "alert_condition_param" = NULL, "data_condition_label" = NULL, "data_filters" = NULL, "prom_content" = '100 - (sum(node_filesystem_avail_bytes) by (instance_id,  siteid, device) * 100) / sum(node_filesystem_size_bytes) by (  instance_id, site_id, device) >= 85', "status" = 0, "bp_id" = NULL, "user_id" = NULL, "create_time" = '2023-11-20 11:50:14.286794+08', "update_time" = '2023-11-20 11:50:14.286794+08' WHERE "id" = '201';
UPDATE "public"."tbl_omc_alert_metric" SET "group_id" = '1', "metric_name" = '节点状态异常', "label" = NULL, "duration_time" = 10, "level" = 3, "message" = '节点{{$labels.node_id}}处于不可用状态超过10分钟', "metric_key" = 'up', "alert_condition_display_statement" = '当 ${metrics_name} 时，满足告警条件。', "alert_condition_param" = '[{"labelName":"metrics_name","showType":"text","detail":{"value":"节点状态异常"}}]', "data_condition_label" = '[{"label":"node_id","labelName":"节点","minWidth":160,"maxWidth":200,"children":null}]', "data_filters" = '[{"filterLabel":"node_id","filterDim":"node_id","filterDimName":"节点","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]}]', "prom_content" = 'up{${node_id}} ==  0', "status" = 0, "bp_id" = NULL, "user_id" = NULL, "create_time" = '2023-11-01 16:07:32.623255+08', "update_time" = '2023-11-01 16:07:32.623255+08' WHERE "id" = '3';
UPDATE "public"."tbl_omc_alert_metric" SET "group_id" = '14', "metric_name" = '虚拟机GPU温度', "label" = NULL, "duration_time" = 10, "level" = 3, "message" = 'nextstack云: {{$labels.cloud_id}}，虚拟机: {{$labels.instanceName}}({{$labels.instanceId}}) GPU温度{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}，当前GPU温度 {{ printf "%.2f" $value }}', "metric_key" = NULL, "alert_condition_display_statement" = '当 ${metrics_name} ${opt} ${value} 时，满足告警条件。', "alert_condition_param" = '[{"labelName":"metrics_name","showType":"text","detail":{"value":"GPU温度"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":90,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', "data_condition_label" = '[{"label":"cloud_id","labelName":"云id","minWidth":160,"maxWidth":200,"children":{"label":"instanceId","labelName":"虚拟机id","minWidth":160,"maxWidth":200}}]', "data_filters" = '[{"filterLabel":"cloud_id","filterDim":"cloud_id","filterDimServiceType":"cmp","filterDimResourceType":"cloud","filterDimField":"cloud_id","filterDimDisplayField":"name","filterDimName":"云id","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"instanceId","filterDim":"instanceId", "filterDimServiceType":"cmp","filterDimResourceType":"ns_vm_instance","filterDimField":"instanceId","filterDimDisplayField":"name","filterDimName":"虚拟机id","valueType":"string","opt":"ALL","supportOpts":[{"label":"等于","value":"="},{"label":"不等于","value":"!="},{"label":"正则匹配","value":"=~"},{"label":"正则不匹配","value":"!~"},{"label":"遍历","value":"ALL"}],"value":"","showFilter":true,"values":[],"staticValue":false}]', "prom_content" = 'nvidia_smi_temperature_gpu{${cloud_id},${instanceId}}  ${opt} ${value}', "status" = 0, "bp_id" = NULL, "user_id" = NULL, "create_time" = '2024-03-26 19:35:10.684073+08', "update_time" = '2024-03-26 19:35:10.684073+08' WHERE "id" = '1403';
UPDATE "public"."tbl_omc_alert_metric" SET "group_id" = '13', "metric_name" = '计算节点GPU显存使用率', "label" = NULL, "duration_time" = 10, "level" = 3, "message" = 'nextstack云: {{$labels.cloud_id}}，计算节点: {{$labels.instance}} GPU显存使用率{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%，当前GPU显存使用率 {{ printf "%.2f" $value }}%', "metric_key" = NULL, "alert_condition_display_statement" = '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', "alert_condition_param" = '[{"labelName":"metrics_name","showType":"text","detail":{"value":"GPU显存使用率"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":90,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', "data_condition_label" = '[{"label":"cloud_id","labelName":"云id","minWidth":160,"maxWidth":200,"children":{"label":"nodeId","labelName":"计算节点id","minWidth":160,"maxWidth":200}}]', "data_filters" = '[{"filterLabel":"cloud_id","filterDim":"cloud_id","filterDimServiceType":"cmp","filterDimResourceType":"cloud","filterDimField":"cloud_id","filterDimDisplayField":"name","filterDimName":"云id","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"nodeId","filterDim":"nodeId", "filterDimServiceType":"cmp","filterDimResourceType":"ns_hypervisor_node","filterDimField":"nodeId","filterDimDisplayField":"name","filterDimPrefixField":"","filterDimSuffixField":"","filterDimName":"计算节点id","valueType":"string","opt":"ALL","supportOpts":[{"label":"等于","value":"="},{"label":"不等于","value":"!="},{"label":"正则匹配","value":"=~"},{"label":"正则不匹配","value":"!~"},{"label":"遍历","value":"ALL"}],"value":"","showFilter":true,"values":[],"staticValue":false}]', "prom_content" = 'nvidia_smi_utilization_memory_ratio{${cloud_id},${nodeId}}  * 100  ${opt} ${value}', "status" = 0, "bp_id" = NULL, "user_id" = NULL, "create_time" = '2024-03-26 19:34:46.185629+08', "update_time" = '2024-03-26 19:34:46.185629+08' WHERE "id" = '1302';
UPDATE "public"."tbl_omc_alert_metric" SET "group_id" = '13', "metric_name" = '计算节点GPU使用率', "label" = NULL, "duration_time" = 10, "level" = 3, "message" = 'nextstack云: {{$labels.cloud_id}}，计算节点: {{$labels.instance}} GPU使用率{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%，当前GPU使用率 {{ printf "%.2f" $value }}%', "metric_key" = NULL, "alert_condition_display_statement" = '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', "alert_condition_param" = '[{"labelName":"metrics_name","showType":"text","detail":{"value":"GPU使用率"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":90,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', "data_condition_label" = '[{"label":"cloud_id","labelName":"云id","minWidth":160,"maxWidth":200,"children":{"label":"nodeId","labelName":"计算节点id","minWidth":160,"maxWidth":200}}]', "data_filters" = '[{"filterLabel":"cloud_id","filterDim":"cloud_id","filterDimServiceType":"cmp","filterDimResourceType":"cloud","filterDimField":"cloud_id","filterDimDisplayField":"name","filterDimName":"云id","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"nodeId","filterDim":"nodeId", "filterDimServiceType":"cmp","filterDimResourceType":"ns_hypervisor_node","filterDimField":"nodeId","filterDimDisplayField":"name","filterDimPrefixField":"","filterDimSuffixField":"","filterDimName":"计算节点id","valueType":"string","opt":"ALL","supportOpts":[{"label":"等于","value":"="},{"label":"不等于","value":"!="},{"label":"正则匹配","value":"=~"},{"label":"正则不匹配","value":"!~"},{"label":"遍历","value":"ALL"}],"value":"","showFilter":true,"values":[],"staticValue":false}]', "prom_content" = 'nvidia_smi_utilization_gpu_ratio{${cloud_id},${nodeId}} * 100 ${opt} ${value}', "status" = 0, "bp_id" = NULL, "user_id" = NULL, "create_time" = '2024-03-26 19:34:40.380523+08', "update_time" = '2024-03-26 19:34:40.380523+08' WHERE "id" = '1301';
UPDATE "public"."tbl_omc_alert_metric" SET "group_id" = '11', "metric_name" = '计算节点实例在线状态', "label" = NULL, "duration_time" = 10, "level" = 3, "message" = 'nextstack云: {{$labels.cloud_id}}，计算节点{{$labels.instance}}处于不可用状态', "metric_key" = NULL, "alert_condition_display_statement" = '当 ${metrics_name} 时，满足告警条件。', "alert_condition_param" = '[{"labelName":"metrics_name","showType":"text","detail":{"value":"实例离线"}}]', "data_condition_label" = '[{"label":"cloud_id","labelName":"云id","minWidth":160,"maxWidth":200,"children":{"label":"instance","labelName":"计算节点","minWidth":160,"maxWidth":200}}]', "data_filters" = '[{"filterLabel":"cloud_id","filterDim":"cloud_id","filterDimServiceType":"cmp","filterDimResourceType":"cloud","filterDimField":"cloud_id","filterDimDisplayField":"name","filterDimName":"云id","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"nodeId","filterDim":"nodeId", "filterDimServiceType":"cmp","filterDimResourceType":"ns_hypervisor_node","filterDimField":"nodeId","filterDimDisplayField":"name","filterDimPrefixField":"","filterDimSuffixField":"","filterDimName":"计算节点id","valueType":"string","opt":"ALL","supportOpts":[{"label":"等于","value":"="},{"label":"不等于","value":"!="},{"label":"正则匹配","value":"=~"},{"label":"正则不匹配","value":"!~"},{"label":"遍历","value":"ALL"}],"value":"","showFilter":true,"values":[],"staticValue":false}]', "prom_content" = 'up{type="libvirt_node",  ${cloud_id} ${instance}}==0', "status" = 0, "bp_id" = NULL, "user_id" = NULL, "create_time" = '2024-03-23 15:50:00.393941+08', "update_time" = '2024-03-23 15:50:00.393941+08' WHERE "id" = '1107';
UPDATE "public"."tbl_omc_alert_metric" SET "group_id" = '1', "metric_name" = '节点内存使用率', "label" = NULL, "duration_time" = 10, "level" = 3, "message" = '节点 {{ $labels.node_id }} 内存使用率{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%，当前内存使用率 {{  printf "%.2f" $value }}%', "metric_key" = 'node_memory_usage', "alert_condition_display_statement" = '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', "alert_condition_param" = '[{"labelName":"metrics_name","showType":"text","detail":{"value":"节点内存使用率"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":90,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', "data_condition_label" = '[{"label":"node_id","labelName":"节点","minWidth":160,"maxWidth":200,"children":null}]', "data_filters" = '[{"filterLabel":"node_id","filterDim":"node_id","filterDimName":"节点","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]}]', "prom_content" = '100 - node_memory_MemAvailable_bytes{${node_id}} / node_memory_MemTotal_bytes{${node_id}} * 100 ${opt} ${value}', "status" = 0, "bp_id" = NULL, "user_id" = NULL, "create_time" = '2023-11-01 15:57:15.934687+08', "update_time" = '2023-11-01 15:57:15.934687+08' WHERE "id" = '2';
UPDATE "public"."tbl_omc_alert_metric" SET "group_id" = '1', "metric_name" = '节点cpu使用率', "label" = NULL, "duration_time" = 10, "level" = 2, "message" = '节点 {{$labels.node_id }} CPU使用率{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%，当前CPU使用率 {{ printf "%.2f" $value }}%', "metric_key" = 'node_cpu_usage', "alert_condition_display_statement" = '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', "alert_condition_param" = '[{"labelName":"metrics_name","showType":"text","detail":{"value":"节点CPU使用率"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":90,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', "data_condition_label" = '[{"label":"node_id","labelName":"节点","minWidth":160,"maxWidth":200,"children":null}]', "data_filters" = '[{"filterLabel":"node_id","filterDim":"node_id","filterDimName":"节点","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]}]', "prom_content" = '100 - avg by(node_id) (rate(node_cpu_seconds_total{mode="idle", ${node_id}}[2m])) * 100 ${opt} ${value}', "status" = 0, "bp_id" = NULL, "user_id" = NULL, "create_time" = '2023-11-01 15:45:59.114137+08', "update_time" = '2023-11-01 15:45:59.114137+08' WHERE "id" = '1';
UPDATE "public"."tbl_omc_alert_metric" SET "group_id" = '1', "metric_name" = '节点磁盘使用率', "label" = NULL, "duration_time" = 10, "level" = 2, "message" = '节点 {{ $labels.node_id }} 磁盘 {{ $labels.device }} 使用率{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%，当前磁盘使用率 {{ printf "%.2f" $value }}%', "metric_key" = 'node_disk_usage', "alert_condition_display_statement" = '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', "alert_condition_param" = '[{"labelName":"metrics_name","showType":"text","detail":{"value":"节点磁盘使用率"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":90,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', "data_condition_label" = '[{"label":"node_id","labelName":"节点","minWidth":160,"maxWidth":200,"children":{"label":"device","labelName":"磁盘","minWidth":160,"maxWidth":200,"children":null}}]', "data_filters" = '[{"filterLabel":"node_id","filterDim":"node_id","filterDimName":"节点","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"device","filterDim":"device","filterDimName":"磁盘","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]}]', "prom_content" = '100 - (sum(node_filesystem_avail_bytes{${node_id}, ${device}}) by (node_id, device) * 100) / sum(node_filesystem_size_bytes{${node_id}, ${device}}) by (node_id, device)  ${opt} ${value}', "status" = 0, "bp_id" = NULL, "user_id" = NULL, "create_time" = '2023-11-01 16:16:54.852724+08', "update_time" = '2023-11-01 16:16:54.852724+08' WHERE "id" = '4';
UPDATE "public"."tbl_omc_alert_metric" SET "group_id" = '4', "metric_name" = '容器内存使用率', "label" = NULL, "duration_time" = 10, "level" = 3, "message" = '节点: {{$labels.node_id}}  / 容器: {{$labels.name}}  (容器id:{{$labels.container_ref_id}}) 内存使用率 {{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%, 当前值{{ printf "%.2f" $value }}%', "metric_key" = 'container_memory_usage', "alert_condition_display_statement" = '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', "alert_condition_param" = '[{"labelName":"metrics_name","showType":"text","detail":{"value":"容器内存使用率"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":80,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', "data_condition_label" = '[{"label":"node_id","labelName":"节点id","minWidth":160,"maxWidth":200,"children":{"label":"name","labelName":"容器名","minWidth":160,"maxWidth":200}}]', "data_filters" = '[{"filterLabel":"node_id","filterDim":"node_id", "filterDimServiceType":"ecrm","filterDimResourceType":"edge","filterDimField":"node_id","filterDimDisplayField":"node_name","filterDimName":"节点id","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"name","filterDim":"name","filterDimServiceType":"cis","filterDimResourceType":"container","filterDimField":"name","filterDimDisplayField":"name","filterDimName":"容器名","valueType":"string","opt":"ALL","supportOpts":[{"label":"等于","value":"="},{"label":"不等于","value":"!="},{"label":"正则匹配","value":"=~"},{"label":"正则不匹配","value":"!~"},{"label":"遍历","value":"ALL"}],"value":"","showFilter":true,"values":[],"staticValue":false}]', "prom_content" = '(sum(container_memory_working_set_bytes {name=~".+",image!="",id!="",${node_id}, ${name}} ) BY (node_id, name,container_ref_id) / sum(container_spec_memory_limit_bytes {name=~".+",image!="",id!="",${node_id}, ${name}} > 0) BY (node_id, name,container_ref_id) * 100)  ${opt} ${value}', "status" = 0, "bp_id" = NULL, "user_id" = NULL, "create_time" = '2023-11-17 16:05:00.88865+08', "update_time" = '2023-11-17 16:05:00.88865+08' WHERE "id" = '301';
UPDATE "public"."tbl_omc_alert_metric" SET "group_id" = '4', "metric_name" = '容器磁盘使用率', "label" = NULL, "duration_time" = 10, "level" = 3, "message" = '节点: {{$labels.node_id}}  / 容器: {{$labels.name}}  (容器id:{{$labels.container_ref_id}}) 磁盘使用率 {{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%, 当前值{{ printf "%.2f" $value }}%', "metric_key" = 'container_fs_inodes_free', "alert_condition_display_statement" = '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', "alert_condition_param" = '[{"labelName":"metrics_name","showType":"text","detail":{"value":"容器磁盘使用率"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":80,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', "data_condition_label" = '[{"label":"node_id","labelName":"节点id","minWidth":160,"maxWidth":200,"children":{"label":"name","labelName":"容器名","minWidth":160,"maxWidth":200}}]', "data_filters" = '[{"filterLabel":"node_id","filterDim":"node_id", "filterDimServiceType":"ecrm","filterDimResourceType":"edge","filterDimField":"node_id","filterDimDisplayField":"node_name","filterDimName":"节点id","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"name","filterDim":"name","filterDimServiceType":"cis","filterDimResourceType":"container","filterDimField":"name","filterDimDisplayField":"name","filterDimName":"容器名","valueType":"string","opt":"ALL","supportOpts":[{"label":"等于","value":"="},{"label":"不等于","value":"!="},{"label":"正则匹配","value":"=~"},{"label":"正则不匹配","value":"!~"},{"label":"遍历","value":"ALL"}],"value":"","showFilter":true,"values":[],"staticValue":false}]', "prom_content" = '(1 - (sum(container_fs_inodes_free{name=~".+",image!="",id!="",${node_id}, ${name}}) BY (node_id, name,container_ref_id) / sum(container_fs_inodes_total) BY (node_id, name,container_ref_id))) * 100 ${opt} ${value}', "status" = 0, "bp_id" = NULL, "user_id" = NULL, "create_time" = '2023-11-17 16:05:00.88865+08', "update_time" = '2023-11-17 16:05:00.88865+08' WHERE "id" = '302';
UPDATE "public"."tbl_omc_alert_metric" SET "group_id" = '4', "metric_name" = '容器离线', "label" = NULL, "duration_time" = 10, "level" = 3, "message" = '节点: {{$labels.node_id}}  / 容器: {{$labels.name}}  (容器id:{{$labels.container_ref_id}}) 容器已被删除或停止', "metric_key" = 'container_last_seen', "alert_condition_display_statement" = '当 ${metrics_name} ${opt} ${value}秒 时，满足告警条件。', "alert_condition_param" = '[{"labelName":"metrics_name","showType":"text","detail":{"value":"离线时间"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":80,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', "data_condition_label" = '[{"label":"node_id","labelName":"节点id","minWidth":160,"maxWidth":200,"children":{"label":"name","labelName":"容器名","minWidth":160,"maxWidth":200}}]', "data_filters" = '[{"filterLabel":"node_id","filterDim":"node_id", "filterDimServiceType":"ecrm","filterDimResourceType":"edge","filterDimField":"node_id","filterDimDisplayField":"node_name","filterDimName":"节点id","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"name","filterDim":"name","filterDimServiceType":"cis","filterDimResourceType":"container","filterDimField":"name","filterDimDisplayField":"name","filterDimName":"容器名","valueType":"string","opt":"ALL","supportOpts":[{"label":"等于","value":"="},{"label":"不等于","value":"!="},{"label":"正则匹配","value":"=~"},{"label":"正则不匹配","value":"!~"},{"label":"遍历","value":"ALL"}],"value":"","showFilter":true,"values":[],"staticValue":false}]', "prom_content" = 'time() - container_last_seen{name=~".+",image!="",id!="",${node_id}, ${name}} ${opt} ${value}', "status" = 0, "bp_id" = NULL, "user_id" = NULL, "create_time" = '2023-11-17 16:05:00.88865+08', "update_time" = '2023-11-17 16:05:00.88865+08' WHERE "id" = '303';
UPDATE "public"."tbl_omc_alert_metric" SET "group_id" = '4', "metric_name" = '容器cpu使用率', "label" = NULL, "duration_time" = 10, "level" = 3, "message" = '节点: {{$labels.node_id}}  / 容器: {{$labels.name}}  (容器id:{{$labels.container_ref_id}}) CPU使用率{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%, 当前值{{ printf "%.2f" $value }}%', "metric_key" = 'container_cpu_usage', "alert_condition_display_statement" = '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', "alert_condition_param" = '[{"labelName":"metrics_name","showType":"text","detail":{"value":"容器CPU使用率"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":80,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', "data_condition_label" = '[{"label":"node_id","labelName":"节点","minWidth":160,"maxWidth":200,"children":{"label":"name","labelName":"容器","minWidth":160,"maxWidth":200}}]', "data_filters" = '[{"filterLabel":"node_id","filterDim":"node_id", "filterDimServiceType":"ecrm","filterDimResourceType":"edge","filterDimField":"node_id","filterDimDisplayField":"node_name","filterDimName":"节点id","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"name","filterDim":"name","filterDimServiceType":"cis","filterDimResourceType":"container","filterDimField":"name","filterDimDisplayField":"name","filterDimName":"容器名","valueType":"string","opt":"ALL","supportOpts":[{"label":"等于","value":"="},{"label":"不等于","value":"!="},{"label":"正则匹配","value":"=~"},{"label":"正则不匹配","value":"!~"},{"label":"遍历","value":"ALL"}],"value":"","showFilter":true,"values":[],"staticValue":false}]', "prom_content" = '(sum(rate(container_cpu_usage_seconds_total{name=~".+",image!="",id!="",${node_id}, ${name}}[3m])) BY (node_id, name,container_ref_id) * 100) ${opt} ${value}', "status" = 0, "bp_id" = NULL, "user_id" = NULL, "create_time" = '2023-11-17 16:04:25.697165+08', "update_time" = '2023-11-17 16:04:25.697165+08' WHERE "id" = '300';
UPDATE "public"."tbl_omc_alert_metric" SET "group_id" = '11', "metric_name" = '计算节点磁盘吞吐率', "label" = NULL, "duration_time" = 10, "level" = 3, "message" = 'nextstack云: {{$labels.cloud_id}}，计算节点: {{$labels.instance}} 磁盘吞吐率{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%，当前磁盘吞吐率 {{ printf "%.2f" $value }}%', "metric_key" = NULL, "alert_condition_display_statement" = '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', "alert_condition_param" = '[{"labelName":"metrics_name","showType":"text","detail":{"value":"计算节点磁盘吞吐率"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":90,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', "data_condition_label" = '[{"label":"cloud_id","labelName":"云id","minWidth":160,"maxWidth":200,"children":{"label":"instance","labelName":"计算节点","minWidth":160,"maxWidth":200}}]', "data_filters" = '[{"filterLabel":"cloud_id","filterDim":"cloud_id","filterDimServiceType":"cmp","filterDimResourceType":"cloud","filterDimField":"cloud_id","filterDimDisplayField":"name","filterDimName":"云id","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"instance","filterDim":"instance", "filterDimServiceType":"cmp","filterDimResourceType":"ns_hypervisor_node","filterDimField":"manageIp","filterDimDisplayField":"name","filterDimPrefixField":"","filterDimSuffixField":":9100","filterDimName":"计算节点","valueType":"string","opt":"ALL","supportOpts":[{"label":"等于","value":"="},{"label":"不等于","value":"!="},{"label":"正则匹配","value":"=~"},{"label":"正则不匹配","value":"!~"},{"label":"遍历","value":"ALL"}],"value":"","showFilter":true,"values":[],"staticValue":false,"placeholder":"ip:port,port为9100"}]', "prom_content" = 'round((irate(node_disk_read_bytes_total{device !~ ''dm.*|nbd.*'',  ${cloud_id}  ${instance}}[5m])+irate(node_disk_written_bytes_total{device !~ ''dm.*|nbd.*'',  ${cloud_id}  ${instance}}[5m]))/1024/1024 ${opt} ${value}  , 0.01) ', "status" = 0, "bp_id" = NULL, "user_id" = NULL, "create_time" = '2024-03-23 15:49:46.791444+08', "update_time" = '2024-03-23 15:49:46.791444+08' WHERE "id" = '1106';
UPDATE "public"."tbl_omc_alert_metric" SET "group_id" = '11', "metric_name" = '计算节点磁盘IOPS', "label" = NULL, "duration_time" = 10, "level" = 3, "message" = 'nextstack云: {{$labels.cloud_id}}，计算节点: {{$labels.instance}} 磁盘IOPS{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%，当前磁盘IOPS {{ printf "%.2f" $value }}%', "metric_key" = NULL, "alert_condition_display_statement" = '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', "alert_condition_param" = '[{"labelName":"metrics_name","showType":"text","detail":{"value":"计算节点磁盘IOPS"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":90,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', "data_condition_label" = '[{"label":"cloud_id","labelName":"云id","minWidth":160,"maxWidth":200,"children":{"label":"instance","labelName":"计算节点","minWidth":160,"maxWidth":200}}]', "data_filters" = '[{"filterLabel":"cloud_id","filterDim":"cloud_id","filterDimServiceType":"cmp","filterDimResourceType":"cloud","filterDimField":"cloud_id","filterDimDisplayField":"name","filterDimName":"云id","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"instance","filterDim":"instance", "filterDimServiceType":"cmp","filterDimResourceType":"ns_hypervisor_node","filterDimField":"manageIp","filterDimDisplayField":"name","filterDimPrefixField":"","filterDimSuffixField":":9100","filterDimName":"计算节点","valueType":"string","opt":"ALL","supportOpts":[{"label":"等于","value":"="},{"label":"不等于","value":"!="},{"label":"正则匹配","value":"=~"},{"label":"正则不匹配","value":"!~"},{"label":"遍历","value":"ALL"}],"value":"","showFilter":true,"values":[],"staticValue":false,"placeholder":"ip:port,port为9100"}]', "prom_content" = 'round(irate(node_disk_reads_completed_total{ device !~ ''dm.*|nbd.*'',  ${cloud_id}  ${instance}}[5m])+irate(node_disk_writes_completed_total{device !~ ''dm.*|nbd.*'',  ${cloud_id}  ${instance}}[5m]) ${opt} ${value}    , 0.01)', "status" = 0, "bp_id" = NULL, "user_id" = NULL, "create_time" = '2024-03-23 15:49:41.702004+08', "update_time" = '2024-03-23 15:49:41.702004+08' WHERE "id" = '1105';
UPDATE "public"."tbl_omc_alert_metric" SET "group_id" = '11', "metric_name" = '计算节点网络吞吐率', "label" = NULL, "duration_time" = 10, "level" = 3, "message" = 'nextstack云: {{$labels.cloud_id}}，计算节点: {{$labels.instance}} 网络吞吐率{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%，当前网络吞吐率 {{ printf "%.2f" $value }}%', "metric_key" = NULL, "alert_condition_display_statement" = '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', "alert_condition_param" = '[{"labelName":"metrics_name","showType":"text","detail":{"value":"计算节点网络吞吐率"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":90,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', "data_condition_label" = '[{"label":"cloud_id","labelName":"云id","minWidth":160,"maxWidth":200,"children":{"label":"instance","labelName":"计算节点","minWidth":160,"maxWidth":200}}]', "data_filters" = '[{"filterLabel":"cloud_id","filterDim":"cloud_id","filterDimServiceType":"cmp","filterDimResourceType":"cloud","filterDimField":"cloud_id","filterDimDisplayField":"name","filterDimName":"云id","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"instance","filterDim":"instance", "filterDimServiceType":"cmp","filterDimResourceType":"ns_hypervisor_node","filterDimField":"manageIp","filterDimDisplayField":"name","filterDimPrefixField":"","filterDimSuffixField":":9100","filterDimName":"计算节点","valueType":"string","opt":"ALL","supportOpts":[{"label":"等于","value":"="},{"label":"不等于","value":"!="},{"label":"正则匹配","value":"=~"},{"label":"正则不匹配","value":"!~"},{"label":"遍历","value":"ALL"}],"value":"","showFilter":true,"values":[],"staticValue":false,"placeholder":"ip:port,port为9100"}]', "prom_content" = 'round((irate(node_network_receive_bytes_total{ device !~ ''br.*|v.*|ovs.*|lo*|docker.*|.*o'',  ${cloud_id}  ${instance}}[5m]) or irate(node_network_transmit_bytes_total{device !~ ''br.*|v.*|ovs.*|lo*|docker.*|.*o'',  ${cloud_id}  ${instance}}[5m]))/1024/1024 ${opt} ${value}   , 0.01)', "status" = 0, "bp_id" = NULL, "user_id" = NULL, "create_time" = '2024-03-23 15:49:36.134082+08', "update_time" = '2024-03-23 15:49:36.134082+08' WHERE "id" = '1104';
UPDATE "public"."tbl_omc_alert_metric" SET "group_id" = '11', "metric_name" = '计算节点文件系统使用率', "label" = NULL, "duration_time" = 10, "level" = 3, "message" = 'nextstack云: {{$labels.cloud_id}}，计算节点: {{$labels.instance}} 计算节点文件系统使用率{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%，当前计算节点文件系统使用率 {{ printf "%.2f" $value }}%', "metric_key" = NULL, "alert_condition_display_statement" = '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', "alert_condition_param" = '[{"labelName":"metrics_name","showType":"text","detail":{"value":"计算节点文件系统使用率"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":90,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', "data_condition_label" = '[{"label":"cloud_id","labelName":"云id","minWidth":160,"maxWidth":200,"children":{"label":"instance","labelName":"计算节点","minWidth":160,"maxWidth":200}}]', "data_filters" = '[{"filterLabel":"cloud_id","filterDim":"cloud_id","filterDimServiceType":"cmp","filterDimResourceType":"cloud","filterDimField":"cloud_id","filterDimDisplayField":"name","filterDimName":"云id","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"instance","filterDim":"instance", "filterDimServiceType":"cmp","filterDimResourceType":"ns_hypervisor_node","filterDimField":"manageIp","filterDimDisplayField":"name","filterDimPrefixField":"","filterDimSuffixField":":9100","filterDimName":"计算节点","valueType":"string","opt":"ALL","supportOpts":[{"label":"等于","value":"="},{"label":"不等于","value":"!="},{"label":"正则匹配","value":"=~"},{"label":"正则不匹配","value":"!~"},{"label":"遍历","value":"ALL"}],"value":"","showFilter":true,"values":[],"staticValue":false,"placeholder":"ip:port,port为9100"}]', "prom_content" = 'round(100.0 - 100 * (node_filesystem_avail_bytes{device !~''tmpfs'',device!~''by-uuid'', ${cloud_id} ${instance}} / node_filesystem_size_bytes{device !~''tmpfs'',device!~''by-uuid'', ${cloud_id}  ${instance}}) ${opt} ${value}    , 0.01)', "status" = 0, "bp_id" = NULL, "user_id" = NULL, "create_time" = '2024-03-23 15:49:25.793958+08', "update_time" = '2024-03-23 15:49:25.793958+08' WHERE "id" = '1103';
UPDATE "public"."tbl_omc_alert_metric" SET "group_id" = '11', "metric_name" = '计算节点CPU使用率', "label" = NULL, "duration_time" = 10, "level" = 3, "message" = 'nextstack云: {{$labels.cloud_id}}，计算节点: {{$labels.instance}} CPU使用率{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%，当前CPU使用率 {{ printf "%.2f" $value }}%', "metric_key" = NULL, "alert_condition_display_statement" = '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', "alert_condition_param" = '[{"labelName":"metrics_name","showType":"text","detail":{"value":"计算节点CPU使用率"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":90,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', "data_condition_label" = '[{"label":"cloud_id","labelName":"云id","minWidth":160,"maxWidth":200,"children":{"label":"instance","labelName":"计算节点","minWidth":160,"maxWidth":200}}]', "data_filters" = '[{"filterLabel":"cloud_id","filterDim":"cloud_id","filterDimServiceType":"cmp","filterDimResourceType":"cloud","filterDimField":"cloud_id","filterDimDisplayField":"name","filterDimName":"云id","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"instance","filterDim":"instance", "filterDimServiceType":"cmp","filterDimResourceType":"ns_hypervisor_node","filterDimField":"manageIp","filterDimDisplayField":"name","filterDimPrefixField":"","filterDimSuffixField":":9100","filterDimName":"计算节点","valueType":"string","opt":"ALL","supportOpts":[{"label":"等于","value":"="},{"label":"不等于","value":"!="},{"label":"正则匹配","value":"=~"},{"label":"正则不匹配","value":"!~"},{"label":"遍历","value":"ALL"}],"value":"","showFilter":true,"values":[],"staticValue":false,"placeholder":"ip:port,port为9100"}]', "prom_content" = 'round(100-(sum(increase(node_cpu_seconds_total{mode=''idle'',  ${cloud_id}  ${instance}}[5m]))by(instance)) /(sum(increase(node_cpu_seconds_total[5m]))by(instance))  ${opt} ${value}   ,0.01)', "status" = 0, "bp_id" = NULL, "user_id" = NULL, "create_time" = '2024-03-23 15:48:53.176851+08', "update_time" = '2024-03-23 15:48:53.176851+08' WHERE "id" = '1101';
UPDATE "public"."tbl_omc_alert_metric" SET "group_id" = '11', "metric_name" = '计算节点内存使用率', "label" = NULL, "duration_time" = 10, "level" = 3, "message" = 'nextstack云: {{$labels.cloud_id}}，计算节点: {{$labels.instance}} 内存使用率{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%，当前内存使用率 {{ printf "%.2f" $value }}%', "metric_key" = NULL, "alert_condition_display_statement" = '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', "alert_condition_param" = '[{"labelName":"metrics_name","showType":"text","detail":{"value":"节点内存使用率"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":90,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', "data_condition_label" = '[{"label":"cloud_id","labelName":"云id","minWidth":160,"maxWidth":200,"children":{"label":"instance","labelName":"计算节点","minWidth":160,"maxWidth":200}}]', "data_filters" = '[{"filterLabel":"cloud_id","filterDim":"cloud_id","filterDimServiceType":"cmp","filterDimResourceType":"cloud","filterDimField":"cloud_id","filterDimDisplayField":"name","filterDimName":"云id","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"instance","filterDim":"instance", "filterDimServiceType":"cmp","filterDimResourceType":"ns_hypervisor_node","filterDimField":"manageIp","filterDimDisplayField":"name","filterDimPrefixField":"","filterDimSuffixField":":9100","filterDimName":"计算节点id","valueType":"string","opt":"ALL","supportOpts":[{"label":"等于","value":"="},{"label":"不等于","value":"!="},{"label":"正则匹配","value":"=~"},{"label":"正则不匹配","value":"!~"},{"label":"遍历","value":"ALL"}],"value":"","showFilter":true,"values":[],"staticValue":false,"placeholder":"ip:port,port为9100"}]', "prom_content" = 'round((1-(node_memory_MemAvailable_bytes{${cloud_id}  ${instance}}/node_memory_MemTotal_bytes{${cloud_id}  ${instance}}))*100 ${opt} ${value}  , 0.01)', "status" = 0, "bp_id" = NULL, "user_id" = NULL, "create_time" = '2024-03-23 15:48:53.176851+08', "update_time" = '2024-03-23 15:48:53.176851+08' WHERE "id" = '1102';
UPDATE "public"."tbl_omc_alert_metric" SET "group_id" = '12', "metric_name" = '虚拟机在线状态', "label" = NULL, "duration_time" = 10, "level" = 3, "message" = '虚拟机{{$labels.instanceName}}({{$labels.instanceId}})处于不可用状态', "metric_key" = NULL, "alert_condition_display_statement" = '当 ${metrics_name} 时，满足告警条件。', "alert_condition_param" = '[{"labelName":"metrics_name","showType":"text","detail":{"value":"实例离线"}}]', "data_condition_label" = '[{"label":"instanceId","labelName":"虚拟机","minWidth":160,"maxWidth":200,"children":null}]', "data_filters" = ' [{"filterLabel":"cloud_id","filterDim":"cloud_id","filterDimServiceType":"cmp","filterDimResourceType":"cloud","filterDimField":"cloud_id","filterDimDisplayField":"name","filterDimName":"云id","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"instanceId","filterDim":"instanceId", "filterDimServiceType":"cmp","filterDimResourceType":"ns_vm_instance","filterDimField":"instanceId","filterDimDisplayField":"name","filterDimName":"虚拟机id","valueType":"string","opt":"ALL","supportOpts":[{"label":"等于","value":"="},{"label":"不等于","value":"!="},{"label":"正则匹配","value":"=~"},{"label":"正则不匹配","value":"!~"},{"label":"遍历","value":"ALL"}],"value":"","showFilter":true,"values":[],"staticValue":false}]', "prom_content" = 'libvirt_domain_state_code{ job="libvirt_server", \${cloud_id},\${instanceId}}==5 or libvirt_domain_state_code{ job="libvirt_server", \${cloud_id},\${instanceId}} ==6', "status" = 0, "bp_id" = NULL, "user_id" = NULL, "create_time" = '2024-03-25 14:25:58.449307+08', "update_time" = '2024-03-25 14:25:58.449307+08' WHERE "id" = '1207';
UPDATE "public"."tbl_omc_alert_metric" SET "group_id" = '12', "metric_name" = '虚拟机磁盘吞吐率', "label" = NULL, "duration_time" = 10, "level" = 3, "message" = 'nextstack云: {{$labels.cloud_id}}，虚拟机: {{$labels.instanceName}}({{$labels.instanceId}}) 磁盘IOPS{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%，当前磁盘IOPS {{ printf "%.2f" $value }}%', "metric_key" = NULL, "alert_condition_display_statement" = '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', "alert_condition_param" = '[{"labelName":"metrics_name","showType":"text","detail":{"value":"虚拟机磁盘吞吐率"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":90,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', "data_condition_label" = '[{"label":"instanceId","labelName":"虚拟机","minWidth":160,"maxWidth":200,"children":null}]', "data_filters" = ' [{"filterLabel":"cloud_id","filterDim":"cloud_id","filterDimServiceType":"cmp","filterDimResourceType":"cloud","filterDimField":"cloud_id","filterDimDisplayField":"name","filterDimName":"云id","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"instanceId","filterDim":"instanceId", "filterDimServiceType":"cmp","filterDimResourceType":"ns_vm_instance","filterDimField":"instanceId","filterDimDisplayField":"name","filterDimName":"虚拟机id","valueType":"string","opt":"ALL","supportOpts":[{"label":"等于","value":"="},{"label":"不等于","value":"!="},{"label":"正则匹配","value":"=~"},{"label":"正则不匹配","value":"!~"},{"label":"遍历","value":"ALL"}],"value":"","showFilter":true,"values":[],"staticValue":false}]', "prom_content" = 'round((rate(libvirt_domain_block_stats_read_bytes_total{\${cloud_id},\${instanceId}}[10m])+rate(libvirt_domain_block_stats_write_bytes_total{\${cloud_id},\${instanceId}}[10m]))/1024/1024 ${opt} ${value}  , 0.01)', "status" = 0, "bp_id" = NULL, "user_id" = NULL, "create_time" = '2024-03-25 14:25:51.333642+08', "update_time" = '2024-03-25 14:25:51.333642+08' WHERE "id" = '1206';
UPDATE "public"."tbl_omc_alert_metric" SET "group_id" = '12', "metric_name" = '虚拟机磁盘IOPS', "label" = NULL, "duration_time" = 10, "level" = 3, "message" = 'nextstack云: {{$labels.cloud_id}}，虚拟机: {{$labels.instanceName}}({{$labels.instanceId}}) 磁盘IOPS{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%，当前磁盘IOPS {{ printf "%.2f" $value }}%', "metric_key" = NULL, "alert_condition_display_statement" = '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', "alert_condition_param" = '[{"labelName":"metrics_name","showType":"text","detail":{"value":"虚拟机磁盘IOPS"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":90,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', "data_condition_label" = '[{"label":"instanceId","labelName":"虚拟机","minWidth":160,"maxWidth":200,"children":null}]', "data_filters" = ' [{"filterLabel":"cloud_id","filterDim":"cloud_id","filterDimServiceType":"cmp","filterDimResourceType":"cloud","filterDimField":"cloud_id","filterDimDisplayField":"name","filterDimName":"云id","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"instanceId","filterDim":"instanceId", "filterDimServiceType":"cmp","filterDimResourceType":"ns_vm_instance","filterDimField":"instanceId","filterDimDisplayField":"name","filterDimName":"虚拟机id","valueType":"string","opt":"ALL","supportOpts":[{"label":"等于","value":"="},{"label":"不等于","value":"!="},{"label":"正则匹配","value":"=~"},{"label":"正则不匹配","value":"!~"},{"label":"遍历","value":"ALL"}],"value":"","showFilter":true,"values":[],"staticValue":false}]', "prom_content" = 'round(rate(libvirt_domain_block_stats_read_requests_total{\${cloud_id},\${instanceId}}[10m])+rate(libvirt_domain_block_stats_write_requests_total{\${cloud_id},\${instanceId}}[10m]) ${opt} ${value}  , 0.01)', "status" = 0, "bp_id" = NULL, "user_id" = NULL, "create_time" = '2024-03-25 14:25:44.169758+08', "update_time" = '2024-03-25 14:25:44.169758+08' WHERE "id" = '1205';
UPDATE "public"."tbl_omc_alert_metric" SET "group_id" = '12', "metric_name" = '虚拟机网络吞吐率', "label" = NULL, "duration_time" = 10, "level" = 3, "message" = 'nextstack云: {{$labels.cloud_id}}，虚拟机: {{$labels.instanceName}}({{$labels.instanceId}}) 网络吞吐率{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%，当前网络吞吐率 {{ printf "%.2f" $value }}%', "metric_key" = NULL, "alert_condition_display_statement" = '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', "alert_condition_param" = '[{"labelName":"metrics_name","showType":"text","detail":{"value":"虚拟机网络吞吐率"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":90,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', "data_condition_label" = '[{"label":"instanceId","labelName":"虚拟机","minWidth":160,"maxWidth":200,"children":null}]', "data_filters" = ' [{"filterLabel":"cloud_id","filterDim":"cloud_id","filterDimServiceType":"cmp","filterDimResourceType":"cloud","filterDimField":"cloud_id","filterDimDisplayField":"name","filterDimName":"云id","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"instanceId","filterDim":"instanceId", "filterDimServiceType":"cmp","filterDimResourceType":"ns_vm_instance","filterDimField":"instanceId","filterDimDisplayField":"name","filterDimName":"虚拟机id","valueType":"string","opt":"ALL","supportOpts":[{"label":"等于","value":"="},{"label":"不等于","value":"!="},{"label":"正则匹配","value":"=~"},{"label":"正则不匹配","value":"!~"},{"label":"遍历","value":"ALL"}],"value":"","showFilter":true,"values":[],"staticValue":false}]', "prom_content" = 'round((rate(libvirt_domain_interface_stats_receive_bytes_total{\${cloud_id},\${instanceId}}[10m])+rate(libvirt_domain_interface_stats_transmit_bytes_total{\${cloud_id},\${instanceId}}[10m]))/1024/1024 ${opt} ${value}  , 0.01)', "status" = 0, "bp_id" = NULL, "user_id" = NULL, "create_time" = '2024-03-25 14:25:36.685417+08', "update_time" = '2024-03-25 14:25:36.685417+08' WHERE "id" = '1204';
UPDATE "public"."tbl_omc_alert_metric" SET "group_id" = '12', "metric_name" = '虚拟机文件系统使用率', "label" = NULL, "duration_time" = 10, "level" = 3, "message" = 'nextstack云: {{$labels.cloud_id}}，虚拟机: {{$labels.instanceName}}({{$labels.instanceId}}) 文件系统使用率{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%，当前计算节点文件系统使用率 {{ printf "%.2f" $value }}%', "metric_key" = NULL, "alert_condition_display_statement" = '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', "alert_condition_param" = '[{"labelName":"metrics_name","showType":"text","detail":{"value":"虚拟机文件系统使用率"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":90,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', "data_condition_label" = '[{"label":"instanceId","labelName":"虚拟机","minWidth":160,"maxWidth":200,"children":null}]', "data_filters" = ' [{"filterLabel":"cloud_id","filterDim":"cloud_id","filterDimServiceType":"cmp","filterDimResourceType":"cloud","filterDimField":"cloud_id","filterDimDisplayField":"name","filterDimName":"云id","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"instanceId","filterDim":"instanceId", "filterDimServiceType":"cmp","filterDimResourceType":"ns_vm_instance","filterDimField":"instanceId","filterDimDisplayField":"name","filterDimName":"虚拟机id","valueType":"string","opt":"ALL","supportOpts":[{"label":"等于","value":"="},{"label":"不等于","value":"!="},{"label":"正则匹配","value":"=~"},{"label":"正则不匹配","value":"!~"},{"label":"遍历","value":"ALL"}],"value":"","showFilter":true,"values":[],"staticValue":false}]', "prom_content" = 'round(ceil(libvirt_domain_filesystem_stats_used_percent{\${cloud_id},\${instanceId}}*100) ${opt} ${value}    , 0.01)', "status" = 0, "bp_id" = NULL, "user_id" = NULL, "create_time" = '2024-03-25 14:25:29.32883+08', "update_time" = '2024-03-25 14:25:29.32883+08' WHERE "id" = '1203';
UPDATE "public"."tbl_omc_alert_metric" SET "group_id" = '12', "metric_name" = '虚拟机内存使用率', "label" = NULL, "duration_time" = 10, "level" = 3, "message" = 'nextstack云: {{$labels.cloud_id}}，虚拟机: {{$labels.instanceName}}({{$labels.instanceId}}) 内存使用率{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%，当前内存使用率 {{ printf "%.2f" $value }}%', "metric_key" = NULL, "alert_condition_display_statement" = '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', "alert_condition_param" = '[{"labelName":"metrics_name","showType":"text","detail":{"value":"虚拟机内存使用率"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":90,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', "data_condition_label" = '[{"label":"instanceId","labelName":"虚拟机","minWidth":160,"maxWidth":200,"children":null}]', "data_filters" = ' [{"filterLabel":"cloud_id","filterDim":"cloud_id","filterDimServiceType":"cmp","filterDimResourceType":"cloud","filterDimField":"cloud_id","filterDimDisplayField":"name","filterDimName":"云id","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"instanceId","filterDim":"instanceId", "filterDimServiceType":"cmp","filterDimResourceType":"ns_vm_instance","filterDimField":"instanceId","filterDimDisplayField":"name","filterDimName":"虚拟机id","valueType":"string","opt":"ALL","supportOpts":[{"label":"等于","value":"="},{"label":"不等于","value":"!="},{"label":"正则匹配","value":"=~"},{"label":"正则不匹配","value":"!~"},{"label":"遍历","value":"ALL"}],"value":"","showFilter":true,"values":[],"staticValue":false}]', "prom_content" = 'round((1-libvirt_domain_stat_memory_usable_bytes{\${cloud_id},\${instanceId}}/libvirt_domain_stat_memory_available_bytes{\${cloud_id},\${instanceId}})*100 ${opt} ${value}  , 0.01)', "status" = 0, "bp_id" = NULL, "user_id" = NULL, "create_time" = '2024-03-25 14:25:21.413899+08', "update_time" = '2024-03-25 14:25:21.413899+08' WHERE "id" = '1202';
UPDATE "public"."tbl_omc_alert_metric" SET "group_id" = '12', "metric_name" = '虚拟机CPU使用率', "label" = NULL, "duration_time" = 10, "level" = 3, "message" = 'nextstack云: {{$labels.cloud_id}}，虚拟机: {{$labels.instanceName}}({{$labels.instanceId}}) CPU使用率{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%，当前CPU使用率 {{ printf "%.2f" $value }}%', "metric_key" = NULL, "alert_condition_display_statement" = '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', "alert_condition_param" = '[{"labelName":"metrics_name","showType":"text","detail":{"value":"虚拟机CPU使用率"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":90,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', "data_condition_label" = '[{"label":"instanceId","labelName":"虚拟机","minWidth":160,"maxWidth":200,"children":null}]', "data_filters" = ' [{"filterLabel":"cloud_id","filterDim":"cloud_id","filterDimServiceType":"cmp","filterDimResourceType":"cloud","filterDimField":"cloud_id","filterDimDisplayField":"name","filterDimName":"云id","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"instanceId","filterDim":"instanceId", "filterDimServiceType":"cmp","filterDimResourceType":"ns_vm_instance","filterDimField":"instanceId","filterDimDisplayField":"name","filterDimName":"虚拟机id","valueType":"string","opt":"ALL","supportOpts":[{"label":"等于","value":"="},{"label":"不等于","value":"!="},{"label":"正则匹配","value":"=~"},{"label":"正则不匹配","value":"!~"},{"label":"遍历","value":"ALL"}],"value":"","showFilter":true,"values":[],"staticValue":false}]', "prom_content" = 'round(rate(libvirt_domain_info_cpu_time_seconds_total{\${cloud_id},\${instanceId}}[10m])/(libvirt_domain_info_virtual_cpus{\${cloud_id},\${instanceId}})*100 ${opt} ${value}  , 0.01)', "status" = 0, "bp_id" = NULL, "user_id" = NULL, "create_time" = '2024-03-25 14:25:12.896074+08', "update_time" = '2024-03-25 14:25:12.896074+08' WHERE "id" = '1201';
UPDATE "public"."tbl_omc_alert_metric" SET "group_id" = '13', "metric_name" = '计算节点GPU温度', "label" = NULL, "duration_time" = 10, "level" = 3, "message" = 'nextstack云: {{$labels.cloud_id}}，计算节点: {{$labels.instance}} GPU温度{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}，当前GPU温度 {{ printf "%.2f" $value }}', "metric_key" = NULL, "alert_condition_display_statement" = '当 ${metrics_name} ${opt} ${value} 时，满足告警条件。', "alert_condition_param" = '[{"labelName":"metrics_name","showType":"text","detail":{"value":"GPU温度"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":90,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', "data_condition_label" = '[{"label":"cloud_id","labelName":"云id","minWidth":160,"maxWidth":200,"children":{"label":"nodeId","labelName":"计算节点id","minWidth":160,"maxWidth":200}}]', "data_filters" = '[{"filterLabel":"cloud_id","filterDim":"cloud_id","filterDimServiceType":"cmp","filterDimResourceType":"cloud","filterDimField":"cloud_id","filterDimDisplayField":"name","filterDimName":"云id","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"nodeId","filterDim":"nodeId", "filterDimServiceType":"cmp","filterDimResourceType":"ns_hypervisor_node","filterDimField":"nodeId","filterDimDisplayField":"name","filterDimPrefixField":"","filterDimSuffixField":"","filterDimName":"计算节点id","valueType":"string","opt":"ALL","supportOpts":[{"label":"等于","value":"="},{"label":"不等于","value":"!="},{"label":"正则匹配","value":"=~"},{"label":"正则不匹配","value":"!~"},{"label":"遍历","value":"ALL"}],"value":"","showFilter":true,"values":[],"staticValue":false}]', "prom_content" = 'nvidia_smi_temperature_gpu{${cloud_id},${nodeId}}  ${opt} ${value}', "status" = 0, "bp_id" = NULL, "user_id" = NULL, "create_time" = '2024-03-26 19:34:50.955362+08', "update_time" = '2024-03-26 19:34:50.955362+08' WHERE "id" = '1303';
UPDATE "public"."tbl_omc_alert_metric" SET "group_id" = '14', "metric_name" = '虚拟机GPU显存使用率', "label" = NULL, "duration_time" = 10, "level" = 3, "message" = 'nextstack云: {{$labels.cloud_id}}，虚拟机: {{$labels.instanceName}}({{$labels.instanceId}}) GPU显存使用率{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%，当前GPU显存使用率 {{ printf "%.2f" $value }}%', "metric_key" = NULL, "alert_condition_display_statement" = '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', "alert_condition_param" = '[{"labelName":"metrics_name","showType":"text","detail":{"value":"GPU显存使用率"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":90,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', "data_condition_label" = '[{"label":"cloud_id","labelName":"云id","minWidth":160,"maxWidth":200,"children":{"label":"instanceId","labelName":"虚拟机id","minWidth":160,"maxWidth":200}}]', "data_filters" = '[{"filterLabel":"cloud_id","filterDim":"cloud_id","filterDimServiceType":"cmp","filterDimResourceType":"cloud","filterDimField":"cloud_id","filterDimDisplayField":"name","filterDimName":"云id","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"instanceId","filterDim":"instanceId", "filterDimServiceType":"cmp","filterDimResourceType":"ns_vm_instance","filterDimField":"instanceId","filterDimDisplayField":"name","filterDimName":"虚拟机id","valueType":"string","opt":"ALL","supportOpts":[{"label":"等于","value":"="},{"label":"不等于","value":"!="},{"label":"正则匹配","value":"=~"},{"label":"正则不匹配","value":"!~"},{"label":"遍历","value":"ALL"}],"value":"","showFilter":true,"values":[],"staticValue":false}]', "prom_content" = 'nvidia_smi_utilization_memory_ratio{${cloud_id},${instanceId}}  * 100  ${opt} ${value}', "status" = 0, "bp_id" = NULL, "user_id" = NULL, "create_time" = '2024-03-26 19:35:00.013832+08', "update_time" = '2024-03-26 19:35:00.013832+08' WHERE "id" = '1402';
UPDATE "public"."tbl_omc_alert_metric" SET "group_id" = '14', "metric_name" = '虚拟机GPU使用率', "label" = NULL, "duration_time" = 10, "level" = 3, "message" = 'nextstack云: {{$labels.cloud_id}}，虚拟机: {{$labels.instanceName}}({{$labels.instanceId}}) GPU使用率{{$labels.metrics_params_opt_label_value}} {{$labels.metrics_params_value}}%，当前GPU使用率 {{ printf "%.2f" $value }}%', "metric_key" = NULL, "alert_condition_display_statement" = '当 ${metrics_name} ${opt} ${value}% 时，满足告警条件。', "alert_condition_param" = '[{"labelName":"metrics_name","showType":"text","detail":{"value":"GPU使用率"}},{"labelName":"opt","showType":"select","detail":{"values":[{"value":"<","label":"小于"},{"value":"<=","label":"小于或等于"},{"value":">","label":"大于"},{"value":">=","label":"大于或等于"},{"value":"=","label":"等于"}],"value":">","minWidth":120,"maxWidth":200}},{"labelName":"value","showType":"input","valueType":"number","detail":{"value":90,"inputType":"number","placeholder":"阈值","minWidth":100,"maxWidth":200}}]', "data_condition_label" = '[{"label":"cloud_id","labelName":"云id","minWidth":160,"maxWidth":200,"children":{"label":"instanceId","labelName":"虚拟机id","minWidth":160,"maxWidth":200}}]', "data_filters" = '[{"filterLabel":"cloud_id","filterDim":"cloud_id","filterDimServiceType":"cmp","filterDimResourceType":"cloud","filterDimField":"cloud_id","filterDimDisplayField":"name","filterDimName":"云id","opt":"ALL","valueType":"string","supportOpts":[{"value":"=","label":"等于"},{"value":"!=","label":"不等于"},{"value":"=~","label":"正则匹配"},{"value":"!~","label":"正则不匹配"},{"value":"ALL","label":"遍历"}]},{"filterLabel":"instanceId","filterDim":"instanceId", "filterDimServiceType":"cmp","filterDimResourceType":"ns_vm_instance","filterDimField":"instanceId","filterDimDisplayField":"name","filterDimName":"虚拟机id","valueType":"string","opt":"ALL","supportOpts":[{"label":"等于","value":"="},{"label":"不等于","value":"!="},{"label":"正则匹配","value":"=~"},{"label":"正则不匹配","value":"!~"},{"label":"遍历","value":"ALL"}],"value":"","showFilter":true,"values":[],"staticValue":false}]', "prom_content" = 'nvidia_smi_utilization_gpu_ratio{${cloud_id},${instanceId}}  * 100  ${opt} ${value}', "status" = 0, "bp_id" = NULL, "user_id" = NULL, "create_time" = '2024-03-26 19:34:55.685682+08', "update_time" = '2024-03-26 19:34:55.685682+08' WHERE "id" = '1401';
